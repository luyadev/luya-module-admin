function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function i18nParam(e,t){var n=i18n[e];return angular.forEach(t,function(e,t){n=n.replace("%"+t+"%",e)}),n}function typeCastValue(e){return angular.isNumber(e)?parseInt(e):e}angular.module("dnd",[]).factory("dndFactory",function(){return{data:{content:null,pos:null,element:null},getElement:function(){return this.data.element},setElement:function(e){this.data.element=e},setContent:function(e){this.data.content=e},getContent:function(){return this.data.content},setPos:function(e){this.data.pos=e},getPos:function(){return this.data.pos}}}).directive("dnd",["dndFactory","AdminClassService",function(l,e){return{restrict:"A",transclude:!1,replace:!1,template:!1,templateURL:!1,scope:{dndModel:"=",dndCss:"=",dndOndrop:"&",dndIsvalid:"&"},link:function(n,i,e){var a=!0,o=e.hasOwnProperty("dndDisableDragMiddle");e.hasOwnProperty("dndDragDisabled")||i.attr("draggable","true"),n.addClass=function(e){i.addClass(e)},n.removeClass=function(e,t){i.removeClass(e)},i.on("dragstart",function(e){if((e=e.originalEvent||e).stopPropagation(),"false"==i.attr("draggable"))return!0;a=!0,l.setContent(n.dndModel),l.setElement(i[0]),n.addClass(n.dndCss.onDrag);try{e.dataTransfer.setData("text","1")}catch(e){try{e.dataTransfer.setData("application/json","1")}catch(e){e.dataTransfer.setData("Text","1")}}}),i.on("dragend",function(e){e=e.originalEvent||e,n.removeClass(n.dndCss.onDrag),e.stopPropagation()}),i.on("dragover",function(e){e=e.originalEvent||e;try{e.dataTransfer.dropEffect="move"}catch(e){}if(e.preventDefault(),e.stopPropagation(),!n.dndIsvalid({hover:n.dndModel,dragged:l.getContent()}))return a=!1;var t=i[0].getBoundingClientRect(),t=100/t.height*(e.clientY-t.top);return o?t<=50?(n.addClass(n.dndCss.onHoverTop),n.removeClass(n.dndCss.onHoverMiddle),n.removeClass(n.dndCss.onHoverBottom),l.setPos("top")):(n.removeClass(n.dndCss.onHoverTop),n.removeClass(n.dndCss.onHoverMiddle),n.addClass(n.dndCss.onHoverBottom),l.setPos("bottom")):t<=25?(n.addClass(n.dndCss.onHoverTop),n.removeClass(n.dndCss.onHoverMiddle),n.removeClass(n.dndCss.onHoverBottom),l.setPos("top")):65<=t?(n.removeClass(n.dndCss.onHoverTop),n.removeClass(n.dndCss.onHoverMiddle),n.addClass(n.dndCss.onHoverBottom),l.setPos("bottom")):(n.removeClass(n.dndCss.onHoverTop),n.addClass(n.dndCss.onHoverMiddle),n.removeClass(n.dndCss.onHoverBottom),l.setPos("middle")),n.addClass(n.dndCss.onHover),!1}),i.on("dragenter",function(e){e=e.originalEvent||e,n.addClass(n.dndCss.onHover),e.preventDefault()}),i.on("dragleave",function(e){n.removeClass(n.dndCss.onHover,!0),n.removeClass(n.dndCss.onHoverTop,!0),n.removeClass(n.dndCss.onHoverMiddle,!0),n.removeClass(n.dndCss.onHoverBottom,!0)}),e.hasOwnProperty("dndDropDisabled")||i.on("drop",function(e){return(e=e.originalEvent||e).preventDefault(),e.stopPropagation(),n.removeClass(n.dndCss.onHover,!0),n.removeClass(n.dndCss.onHoverTop,!0),n.removeClass(n.dndCss.onHoverMiddle,!0),n.removeClass(n.dndCss.onHoverBottom,!0),!!a&&(n.$apply(function(){n.dndOndrop({dragged:l.getContent(),dropped:n.dndModel,position:l.getPos(),element:l.getElement()})}),!0)})}}}]);var zaa=angular.module("zaa",["ui.router","dnd","angular-loading-bar","ngFileUpload","ngWig","flow","angular.filter","720kb.datepicker","directive.ngColorwheel","uiCropper"]);zaa.config(["$httpProvider","$stateProvider","$controllerProvider","$urlMatcherFactoryProvider",function(e,t,n,i){e.interceptors.push("authInterceptor"),zaa.bootstrap=n,i.strictMode(!1),t.state("default",{url:"/default/:moduleId",templateUrl:function(e){return"admin/template/default"}}).state("default.route",{url:"/:moduleRouteId/:controllerId/:actionId",templateUrl:function(e){return e.moduleRouteId+"/"+e.controllerId+"/"+e.actionId},parent:"default",resolve:{adminServiceResolver:adminServiceResolver}}).state("custom",{url:"/template/:templateId",templateUrl:function(e){return e.templateId},resolve:{adminServiceResolver:adminServiceResolver,resolverProvider:["resolver",function(e){return e.then}]}}).state("home",{url:"",templateUrl:"admin/default/dashboard",controller:["$scope",function(e){e.$parent.currentItem={icon:"home",alias:i18n.menu_dashboard}}]}).state("default.route.detail",{url:"/:id",parent:"default.route",template:"<ui-view/>",controller:["$scope","$stateParams",function(e,t){e.crud=e.$parent,e.init=function(){e.crud.config.inline||e.crud.data.updateId!=t.id&&e.crud.toggleUpdate(t.id)},e.init()}]})}]),zaa.provider("resolver",[function(){var a=[];this.addCallback=function(e){a.push(e)},this.$get=["$injector","$q","$state",function(i,e,t){return e(function(e,t){for(var n in a)i.invoke(a[n])})}]}]),zaa.factory("LuyaLoading",["$timeout",function(t){var n=!1,i=null,a=null;return{start:function(e){i=null==e?i18n.js_zaa_server_proccess:e,t.cancel(a),n=!0,a=t(function(){n=!0},1e3)},stop:function(){t.cancel(a),n=!1},getStateMessage:function(){return i},getState:function(){return n}}}]),zaa.factory("AdminClassService",function(){var n=[];return n.vars={},n.getClassSpace=function(e){if(n.vars.hasOwnProperty(e))return n.vars[e]},n.hasClassSpace=function(e){return!!n.vars.hasOwnProperty(e)},n.setClassSpace=function(e,t){n.vars[e]=t},n.clearSpace=function(e){n.vars.hasOwnProperty(e)&&(n.vars[e]=null)},n.removeSpace=function(e){n.hasClassSpace(e)&&delete n.vars[e]},n.stack=0,n.modalStackPush=function(){n.stack+=1},n.modalStackRemove=function(){n.stack<=1?n.stack=0:--n.stack},n.modalStackRemoveAll=function(){n.stack=0},n.modalStackIsEmpty=function(){return 0==n.stack},n}),zaa.factory("CacheReloadService",["$http","$window",function(e,t){var n=[];return n.reload=function(){e.get("admin/api-admin-common/cache").then(function(e){t.location.reload()})},n}]),zaa.factory("authInterceptor",["$rootScope","$q","AdminToastService","AdminDebugBar",function(n,i,t,a){return{request:function(e){e.hasOwnProperty("ignoreLoadingBar")||(e.debugId=a.pushRequest(e)),t=(e.hasOwnProperty("authToken")?e:n.luyacfg).authToken,e.headers=e.headers||{},e.headers.Authorization="Bearer "+t;var t=document.head.querySelector("[name=csrf-token]");return null!==t&&(e.headers["X-CSRF-Token"]=t.content),e||i.when(e)},response:function(e){return e.hasOwnProperty("ignoreLoadingBar")||a.pushResponse(e),e||i.when(e)},responseError:function(e){return 401==e.status||403==e.status||405==e.status?e.config.hasOwnProperty("authToken")||(window.location="admin/default/logout?autologout=1"):404==e.status?e.data.hasOwnProperty("message")?t.info(e.data.message,1e4):t.info("Response Error: "+e.status+" "+e.statusText,1e4):422!=e.status&&(e.data.hasOwnProperty("message")?t.error(e.data.message,1e4):t.error("Response Error: "+e.status+" "+e.statusText,1e4)),i.reject(e)}}}]),adminServiceResolver=["ServiceFoldersData","ServiceFiltersData","ServiceLanguagesData","ServicePropertiesData","AdminLangService","ServiceFoldersDirecotryId",function(e,t,n,i,a,o){t.load(),e.load(),n.load(),i.load(),a.load(),o.load()}],zaa.factory("ServiceQueueWaiting",["$http","$q","$timeout",function(i,a,e){var o={ids:[],waitFor:function(i){return a(function(t,e){var n;0==i.length?t():(i.forEach(function(e){return o.ids.push(e)}),n=[],i.forEach(function(e){n.push(o.waitForJobId(e))}),a.all(n).then(function(e){t()}))})},waitForJobId:function(n){return a(function(t,e){i.get("admin/api-admin-common/queue-job?jobId="+n,{ignoreLoadingBar:!0}).then(function(e){e.data.is_done?-1<(e=o.ids.indexOf(n))&&(o.ids.splice(e,1),t()):setTimeout(function(){o.waitForJobId(n).then(function(e){t()})},500)})})}};return o}]),zaa.factory("ServiceAdminTags",["$http","$q","$rootScope",function(i,e,a){var o={data:null,load:function(n){return e(function(t,e){null!==o.data&&!0!==n?t(o.data):i.get("admin/api-admin-common/tags").then(function(e){o.data=e.data,a.$broadcast("service:AdminTags",o.data),t(o.data)})})}};return o}]),zaa.factory("ServiceFoldersData",["$http","$q","$rootScope",function(i,e,a){var o=[];return o.data=null,o.load=function(n){return e(function(t,e){null!==o.data&&!0!==n?t(o.data):i.get("admin/api-admin-storage/data-folders").then(function(e){o.data=e.data,a.$broadcast("service:FoldersData",o.data),t(o.data)})})},o}]),zaa.factory("ServiceFoldersDirecotryId",["$http","$q","$rootScope",function(i,e,a){var o=[];return o.folderId=!1,o.load=function(n){return e(function(t,e){!1!==o.folderId&&!0!==n?t(o.folderId):i.get("admin/api-admin-common/get-filemanager-folder-state").then(function(e){o.folderId=e.data,a.$broadcast("service:FoldersDirectoryId",o.folderId),t(o.folderId)})})},o}]),zaa.factory("ServiceImagesData",["$http","$q","$rootScope","$log",function(a,e,t,n){var o=[];return o.data={},o.getImage=function(n,i){return e(function(t,e){return 0==n?e(n):o.data.hasOwnProperty(n)&&!0!==i?t(o.data[n]):void a.get("admin/api-admin-storage/image-info?id="+n).then(function(e){e=e.data;return o.data[e.id]=e,t(e)})})},o.loadImages=function(n){return e(function(t,e){return 0==n.length?t():void a.post("admin/api-admin-storage/images-info?expand=source,tinyCropImage",{ids:n}).then(function(e){return angular.forEach(e.data,function(e){o.data[e.id]=e}),t()})})},o}]),zaa.factory("ServiceFilesData",["$http","$q","$rootScope","$log",function(a,e,t,n){var o=[];return o.data={},o._promises={},o.getFile=function(e,t){if(o._promises.hasOwnProperty(e))return o._promises[e];t=o.newPromise(e,t);return o._promises[e]=t},o.newPromise=function(n,i){return e(function(t,e){return 0==n?e(n):o.data.hasOwnProperty(n)&&!0!==i?t(o.data[n]):void a.get("admin/api-admin-storage/file-info?id="+n).then(function(e){e=e.data;return o.data[e.id]=e,delete o._promises[n],t(e)})})},o}]),zaa.factory("ServiceFiltersData",["$http","$q","$rootScope",function(i,e,a){var o=[];return o.data=null,o.load=function(n){return e(function(t,e){null!==o.data&&!0!==n?t(o.data):i.get("admin/api-admin-storage/data-filters").then(function(e){o.data=e.data,a.$broadcast("service:FiltersData",o.data),t(o.data)})})},o}]),zaa.factory("ServiceLanguagesData",["$http","$q","$rootScope",function(i,e,a){var o=[];return o.data=[],o.load=function(n){return e(function(t,e){0<o.data.length&&!0!==n?t(o.data):i.get("admin/api-admin-common/data-languages").then(function(e){o.data=e.data,a.$broadcast("service:LanguagesData",o.data),t(o.data)})})},o}]),zaa.factory("ServicePropertiesData",["$http","$q","$rootScope",function(i,e,a){var o=[];return o.data=null,o.load=function(n){return e(function(t,e){null!==o.data&&!0!==n?t(o.data):i.get("admin/api-admin-common/data-properties").then(function(e){o.data=e.data,a.$broadcast("service:PropertiesData",o.data),t(o.data)})})},o}]),zaa.factory("CrudTabService",function(){var o=[];return o.tabs=[],o.remove=function(e,t){o.tabs.splice(e,1),0<o.tabs.length?o.tabs.slice(-1)[0].active=!0:t.switchTo(0)},o.addTab=function(e,t,n,i,a){a={id:e,api:t,arrayIndex:n,active:!0,name:i,modelClass:a};angular.forEach(o.tabs,function(e){e.active=!1}),o.tabs.push(a)},o.clear=function(){o.tabs=[]},o}),zaa.factory("AdminLangService",["ServiceLanguagesData","$rootScope",function(e,n){var i=[];return i.data=[],i.selection=[],i.toggleSelection=function(e){var t=i.selection.indexOf(e.short_code);-1==t?(i.selection.push(e.short_code),n.$broadcast("service:LoadLanguage",e)):1<i.selection.length&&i.selection.splice(t,1)},i.isInSelection=function(e){return-1!=i.selection.indexOf(e)},i.resetDefault=function(){i.selection=[],angular.forEach(e.data,function(e,t){1==e.is_default&&(i.isInSelection(e.short_code)||i.toggleSelection(e))})},i.load=function(){e.load().then(function(e){i.data=e,angular.forEach(e,function(e){1==e.is_default&&(i.isInSelection(e.short_code)||i.toggleSelection(e))})})},i}]),zaa.factory("AdminDebugBar",function(){var i=[];return i.data=[],i.clear=function(){i.data=[]},i.pushRequest=function(e){return i.data.push({url:e.url,requestData:e.data,responseData:null,responseStatus:null,start:new Date,end:null,parseTime:null})},i.pushResponse=function(e){var t=e,n=i.data[t.config.debugId];return n&&(n.responseData=t.data,n.responseStatus=t.status,n.end=new Date,n.parseTime=new Date-n.start),e},i}),zaa.factory("AdminToastService",["$q","$timeout","$injector",function(e,a,o){var l=[];return l.notify=function(e,t,n){null==t&&(t=6e3);var i=guid();l.queue[i]={message:e,timeout:t,uuid:i,type:n,close:function(){delete l.queue[this.uuid]}},a(function(){delete l.queue[i]},t)},l.success=function(e,t){l.notify(e,t,"success")},l.info=function(e,t){l.notify(e,t,"info")},l.warning=function(e,t){l.notify(e,t,"warning")},l.error=function(e,t){l.notify(e,t,"error")},l.errorArray=function(e,n){angular.forEach(e,function(e,t){l.error(e.message,n)})},l.confirm=function(e,t,n){var i=guid();l.queue[i]={message:e,title:t,click:function(){var t=this,e=o.invoke(this.callback,this,{$toast:this});void 0!==e&&e.then(function(e){t.close()},function(e){t.close()},function(e){})},uuid:i,callback:n,type:"confirm",close:function(){delete l.queue[this.uuid]}}},l.queue={},l}]),zaa.factory("HtmlStorage",function(){var n={data:{},isLoaded:!1,loadData:function(){var e;n.isLoaded||localStorage.getItem("HtmlStorage")&&(e=angular.fromJson(localStorage.getItem("HtmlStorage")),n.data=e)},saveData:function(){localStorage.removeItem("HtmlStorage"),localStorage.setItem("HtmlStorage",angular.toJson(n.data))},getValue:function(e,t){return n.loadData(),n.data.hasOwnProperty(e)?n.data[e]:t},setValue:function(e,t){n.loadData(),n.data[e]=t,n.saveData()}};return n}),zaa.filter("filemanagerdirsfilter",function(){return function(e,n){var i=[];return angular.forEach(e,function(e,t){e.parentId==n&&i.push(e)}),i.sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}),i}}),zaa.filter("findthumbnail",function(){return function(e,n,i){var a=!1;return angular.forEach(e,function(e,t){a||e.fileId==n&&e.filterId==i&&(a=e)}),a}}),zaa.filter("findidfilter",function(){return function(e,n){var i=!1;return angular.forEach(e,function(e,t){e.id==n&&(i=e)}),i}}),zaa.filter("filemanagerfilesfilter",function(){return function(e,t,n){var i=[];return angular.forEach(e,function(e){n?e.folderId==t&&1==e.isImage&&i.push(e):e.folderId==t&&i.push(e)}),i}}),zaa.filter("trustAsUnsafe",["$sce",function(n){return function(e,t){return n.trustAsHtml(e)}}]),zaa.filter("srcbox",function(){return function(e,t){if(!e)return e;if(!t)return e;var a=(""+t).toLowerCase(),o={};return angular.forEach(e,function(n,i){angular.forEach(n,function(e,t){-1!==(""+e).toLowerCase().indexOf(a)&&(o[i]=n)})}),o}}),zaa.filter("trustAsResourceUrl",["$sce",function(n){return function(e,t){return t?n.trustAsResourceUrl(e):null}}]),zaa.filter("truncateMiddle",function(){return function(e,t,n){if(e.length<=(t=t||30))return e;t=(t-(n=n||"...").length)/2;return e.substring(0,t)+n+e.substring(e.length-t,e.length)}}),zaa.directive("echarts",[function(){return{scope:{id:"@",theme:"@",data:"="},restrict:"E",template:'<div style="min-height:300px;height:auto;width:100%;"></div>',replace:!0,controller:["$scope",function(e){e.theme&&(e.theme="macarons")}],link:function(e){var t=echarts.init(document.getElementById(e.id),e.theme);e.$watch("data",function(e){e&&null!=e&&t.setOption(angular.fromJson(e))}),angular.element(window).bind("resize",function(){t.resize()})}}}]),zaa.directive("compileHtml",["$compile","$parse",function(a,o){return{restrict:"A",link:function(e,t,n){var i=o(n.ngBindHtml);e.$watch(function(){return(i(e)||"").toString()},function(){a(t,null,-9999)(e)})}}}]),zaa.directive("selectOnClick",function(){return function(e,t,n){t.bind("click",function(){this.select()})}}),zaa.directive("zaaEsc",["$document",function(i){return function(t,e,n){i.on("keyup",function(e){27==e.keyCode&&t.$apply(function(){t.$eval(n.zaaEsc)})})}}]),zaa.directive("linkObjectToString",function(){return{restrict:"E",relace:!0,scope:{link:"="},template:function(){return'<span><span ng-if="link.type==1"><show-internal-redirection nav-id="link.value" /></span><span ng-if="link.type==2">{{link.value}}</span><span ng-if="link.type==3"><storage-file-display file-id="{{link.value}}"></storage-file-display></span><span ng-if="link.type==4">{{link.value}}</span><span ng-if="link.type==5">{{link.value}}</span></span>'}}}),zaa.directive("tooltip",["$document","$http",function(l,r){return{restrict:"A",scope:{tooltipText:"@",tooltipExpression:"=",tooltipPosition:"@",tooltipOffsetTop:"@",tooltipOffsetLeft:"@",tooltipImageUrl:"@",tooltipPreviewUrl:"@",tooltipDisabled:"="},link:function(n,i,e){function a(){var e={},e="function"==typeof o[n.tooltipPosition]?o[n.tooltipPosition]():o.right(),t=parseInt(n.tooltipOffsetTop);t&&(e.top=e.top+t),(t=parseInt(n.tooltipOffsetLeft))&&(e.left=e.left+t),n.pop.css(e)}var o={top:function(){var e=i[0].getBoundingClientRect();return{top:e.top-n.pop.outerHeight(),left:e.left+e.width/2-n.pop.outerWidth()/2}},bottom:function(){var e=i[0].getBoundingClientRect();return{top:e.top+e.height,left:e.left+e.width/2-n.pop.outerWidth()/2}},right:function(){var e=i[0].getBoundingClientRect();return{top:e.top+e.height/2-n.pop.outerHeight()/2,left:e.left+e.width}},left:function(){var e=i[0].getBoundingClientRect();return{top:e.top+e.height/2-n.pop.outerHeight()/2,left:e.left-n.pop.outerWidth()}}};i.on("mouseenter",function(){var t,e;n.pop||void 0!==n.tooltipDisabled&&!1!==n.tooltipDisabled||(n.tooltipExpression&&(n.tooltipText=n.tooltipExpression),e='<div class="tooltip tooltip-'+(n.tooltipPosition||"right")+(n.tooltipImageUrl?" tooltip-image":"")+'" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner">'+(n.tooltipText?'<span class="tooltip-text">'+n.tooltipText+"</span>":"")+"</div></div>",t=$(e),n.tooltipImageUrl&&((e=new Image).onload=function(){a()},e.src=n.tooltipImageUrl,t.find(".tooltip-inner").append(e)),n.tooltipPreviewUrl&&r.get(n.tooltipPreviewUrl).then(function(e){t.find(".tooltip-inner").append('<div class="tooltip-preview">'+e.data+"</div>")}),n.pop=t,l.find("body").append(n.pop),n.pop.hide()),!n.pop||void 0!==n.tooltipDisabled&&!1!==n.tooltipDisabled||(a(),i.parents().on("scroll",a),n.pop.show())}),i.on("mouseleave",function(){i.parents().off("scroll",a),n.pop&&n.pop.hide()}),n.$on("$destroy",function(){n.pop&&n.pop.remove()})}}}]),zaa.directive("convertToNumber",function(){return{require:"ngModel",link:function(e,t,n,i){i.$parsers.push(function(e){return null!=e?parseInt(e,10):null}),i.$formatters.push(function(e){return null!=e?""+e:null})}}}),zaa.directive("autoGrow",function(){return function(e,t,n){function i(){null==a&&(a=angular.element("<div></div>").css({position:"absolute",top:-1e4,left:-1e4,resize:"none"}),angular.element(document.body).append(a)),a.css({fontSize:t.css("font-size"),fontFamily:t.css("font-family"),lineHeight:t.css("line-height"),width:t.width(),paddingTop:t.css("padding-top"),paddingBottom:t.css("padding-bottom")});var e=t.val().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/\s{2,}/g,function(e){return function(e,t){for(var n=0,i="";n<t;n++)i+=e;return i}("&nbsp;",e.length-1)+" "});a.html(e),t.css("height",a.outerHeight()+10+"px")}var a=null;t.bind("keyup keydown keypress change click",i),t.bind("blur",function(){null!=a&&(a.remove(),a=null)}),i()}}),zaa.directive("resizer",["$document",function(o){return{scope:{trigger:"@"},link:function(e,t,n){function i(e){$(n.resizerCover).show();var t=e.pageX,e=window.innerWidth;e-400<(t=t<600?600:t)&&(t=e-400);$(n.resizerLeft).width(),$(n.resizerRight).width();$(n.resizerLeft).css({width:t+"px"}),$(n.resizerRight).css({width:e-t+"px"})}function a(){$(n.resizerCover).hide(),o.unbind("mousemove",i),o.unbind("mouseup",a)}e.$watch("trigger",function(e,t){0==e&&($(n.resizerLeft).removeAttr("style"),$(n.resizerRight).removeAttr("style"))}),t.on("mousedown",function(e){e.preventDefault(),o.on("mousemove",i),o.on("mouseup",a)})}}}]),zaa.directive("ngConfirmClick",function(){return{link:function(t,e,n){var i=n.ngConfirmClick||"Are you sure?",a=n.confirmedClick;e.bind("click",function(e){window.confirm(i)&&t.$eval(a)})}}}),zaa.directive("focusMe",["$timeout","$parse",function(i,a){return{link:function(e,t,n){n=a(n.focusMe);e.$watch(n,function(e){!0===e&&i(function(){t[0].focus()})})}}}]),zaa.directive("clickPastePusher",["$rootScope","$compile",function(i,e){return{restrict:"A",replace:!1,link:function(e,t,n){t.bind("click",function(){i.$broadcast("insertPasteListener",n.clickPastePusher)})}}}]),zaa.directive("insertPasteListener",["$rootScope",function(r){return{restrict:"A",link:function(e,l,t){l.bind("focus",function(){r.lastElement=l[0];r.$on("insertPasteListener",function(e,t){var n,i,a,o=r.lastElement;if(o!=l[0]||!o)return!1;r.$$listeners.insertPasteListener=[],document.selection?(o.focus(),document.selection.createRange().text=t,o.focus()):o.selectionStart||0===o.selectionStart?(n=o.selectionStart,i=o.selectionEnd,a=o.scrollTop,o.value=o.value.substring(0,n)+t+o.value.substring(i,o.value.length),o.focus(),o.selectionStart=n+t.length,o.selectionEnd=n+t.length,o.scrollTop=a):(o.value+=t,o.focus())})})}}}]),zaa.directive("modal",["$timeout",function(e){return{restrict:"E",scope:{isModalHidden:"=",title:"@modalTitle"},replace:!0,transclude:!0,templateUrl:"modal",controller:["$scope","AdminClassService",function(e,n){e.$watch("isModalHidden",function(e,t){e!==t&&(e?n.modalStackRemove():n.modalStackPush())}),e.escModal=function(){e.isModalHidden=!0,n.modalStackRemoveAll()}}],link:function(e,t){e.$on("$destroy",function(){t.remove()}),angular.element(document.body).append(t)}}}]),zaa.directive("collapseContainer",[function(){return{restrict:"E",scope:{title:"@",icon:"@"},replace:!0,transclude:!0,controller:["$scope",function(e){e.visible=!1,e.toggleVisibility=function(){e.visible=!e.visible}}],template:function(){return'<div class="card" ng-class="{\'card-closed\': !visible}"><div class="card-header" ng-click="toggleVisibility()"><span class="material-icons card-toggle-indicator">keyboard_arrow_down</span><i class="material-icons" ng-show="icon">{{icon}}</i><span>{{title}}</span></div><div class="card-body" ng-transclude></div></div>'}}}]),zaa.directive("crudLoader",["$http","$sce",function(t,i){return{restrict:"E",replace:!0,transclude:!1,scope:{api:"@",alias:"@",modelSelection:"@",modelSetter:"="},controller:["$scope",function(n){n.input={showWindow:!0},n.content=null,n.toggleWindow=function(){var e;n.input.showWindow?(e=-1<n.api.indexOf("?")?n.api+"&inline=1":n.api+"?inline=1",parseInt(n.modelSelection)&&(e=e+"&modelSelection="+n.modelSetter),t.get(e).then(function(e){n.content=i.trustAsHtml(e.data),n.input.showWindow=!1})):("function"==typeof n.$parent.loadService&&n.$parent.loadService(),n.input.showWindow=!0)},n.$watch("input.showWindow",function(e,t){e!==t&&1==e&&"function"==typeof n.$parent.loadService&&n.$parent.loadService()}),n.setModelValue=function(e,t){n.modelSetter=e,n.toggleWindow()}}],template:function(){return'<div class="crud-loader-tag"><button ng-click="toggleWindow()" type="button" class="btn btn-info btn-icon"><i class="material-icons">playlist_add</i></button><modal is-modal-hidden="input.showWindow" modal-title="{{alias}}"><div class="modal-body" compile-html ng-bind-html="content"></modal></div>'}}}]),zaa.directive("crudRelationLoader",["$http","$sce",function(n,i){return{restrict:"E",replace:!0,transclude:!1,scope:{api:"@api",arrayIndex:"@arrayIndex",modelClass:"@modelClass",id:"@id"},controller:["$scope",function(t){var e;t.content=null,e=-1<t.api.indexOf("?")?t.api+"&inline=1":t.api+"?inline=1",n.get(e+"&relation="+t.id+"&arrayIndex="+t.arrayIndex+"&modelClass="+t.modelClass).then(function(e){t.content=i.trustAsHtml(e.data)})}],template:function(){return'<div compile-html ng-bind-html="content"></div>'}}}]),zaa.directive("storageFileDisplay",function(){return{restrict:"E",scope:{fileId:"@fileId"},controller:["$scope","$filter","ServiceFilesData",function(n,e,i){n.fileId=0,n.fileinfo=null,n.$watch("fileId",function(e,t){0!=e&&null!=e&&null!=e&&i.getFile(e).then(function(e){n.fileinfo=e},function(){n.fileinfo=null})})}],template:function(){return'<a ng-show="fileinfo" href="{{ fileinfo.source }}" target="_blank">{{ fileinfo.name_original }}</a>'}}}),zaa.directive("storageImageCrudList",function(){return{restrict:"E",scope:{imageId:"@imageId"},controller:["$scope","ServiceImagesData",function(n,t){n.imageSrc=null,n.$watch("imageId",function(e,t){e!=t&&(n.imageSrc=null),e&&n.evaluateImages()}),n.$on("requestImageSourceReady",function(){n.evaluateImages()}),n.evaluateImages=function(){0==n.imageId||n.imageSrc||t.getImage(n.imageId).then(function(e){e.tinyCropImage?n.imageSrc=e.tinyCropImage.source:t.getImage(n.imageId,!0).then(function(e){e.tinyCropImage&&(n.imageSrc=e.tinyCropImage.source)})})}}],template:function(){return'<img ng-show="imageSrc" ng-src="{{imageSrc}}" alt="{{imageSrc}}" class="img-fluid rounded border" />'}}}),zaa.directive("storageImageThumbnailDisplay",function(){return{restrict:"E",scope:{imageId:"@imageId"},controller:["$scope","$filter","ServiceImagesData","ServiceFilesData",function(n,e,i,t){n.$watch("imageId",function(e,t){e!=t&&(n.imageSrc=null)}),n.$watch(function(){return n.imageId},function(e,t){null!=e&&i.getImage(e).then(function(e){n.imageSrc=e.tinyCropImage.source},function(){n.imageSrc=null})}),n.imageSrc=null}],template:function(){return'<div ng-show="imageSrc"><img ng-src="{{imageSrc}}" alt="{{imageSrc}}" class="img-fluid" /></div>'}}}),zaa.directive("storageFileUpload",function(){return{restrict:"E",scope:{ngModel:"="},controller:["$scope","$filter","ServiceFilesData",function(t,e,n){t.modal={state:1},t.modalContainer=!1,t.fileinfo=null,t.select=function(e){t.toggleModal(),t.ngModel=e},t.reset=function(){t.ngModel=0,t.fileinfo=null},t.toggleModal=function(){t.modalContainer=!t.modalContainer,t.modal.state=!t.modal.state},t.$watch(function(){return t.ngModel},function(e){return null!=e&&angular.isNumber(e)?void n.getFile(e).then(function(e){t.fileinfo=e},function(){t.fileinfo=null}):null})}],templateUrl:"storageFileUpload"}}),zaa.directive("storageImageUpload",function(){return{restrict:"E",scope:{ngModel:"=",options:"="},controller:["$scope","$http","$filter","ServiceFiltersData","ServiceImagesData","AdminToastService","ServiceFilesData",function(n,t,i,e,a,o,l){n.filtersData=e.data,n.$on("service:FiltersData",function(e,t){n.filtersData=t}),n.noFilters=function(){if(n.options)return n.options.no_filter},n.thumbnailfilter=null,n.imageLoading=!1,n.fileId=0,n.filterId=0,n.imageinfo=null,n.imageNotFoundError=!1,n.thumb=!1,n.filterApply=function(){n.imageLoading=!0,l.getFile(n.fileId).then(function(e){e=i("filter")(e.images,{filter_id:n.filterId});0==e.length?t.post("admin/api-admin-storage/image-filter",{fileId:n.fileId,filterId:n.filterId}).then(function(e){n.ngModel=e.data.id,o.success(i18n.js_dir_image_upload_ok),n.imageLoading=!1},function(e){o.error(i18n.js_dir_image_filter_error),n.imageLoading=!1}):(n.ngModel=e[0].id,n.imageLoading=!1)},function(){n.imageinfo=null,n.thumb=!1,n.ngModel=0})},n.changeFilter=function(){n.filterApply()},n.$watch(function(){return n.fileId},function(e,t){null!=e&&n.filterApply()}),n.$watch(function(){return n.ngModel},function(e,t){null!=e&&0!=e&&a.getImage(e).then(function(e){n.applyImageDetails(e),n.fileId=e.file_id,n.filterId=e.filter_id},function(){n.fileId=0,n.filterId=0,n.imageinfo=null,n.thumb=!1})}),n.applyImageDetails=function(e){n.imageinfo=e,n.thumb=e}}],templateUrl:"storageImageUpload"}}),zaa.directive("storageFileManager",function(){return{restrict:"E",transclude:!1,scope:{allowSelection:"@selection",onlyImages:"@onlyImages"},controller:["$scope","$http","$filter","$timeout","$q","HtmlStorage","cfpLoadingBar","Upload","ServiceFoldersData","ServiceFilesData","LuyaLoading","AdminToastService","ServiceFoldersDirecotryId","ServiceAdminTags","ServiceQueueWaiting",function(a,o,t,e,l,r,n,i,s,d,c,u,p,f,m){a.foldersData=s.data,a.$on("service:FoldersData",function(e,t){a.foldersData=t}),a.foldersDataReload=function(){return s.load(!0)},a.tags=[],f.load().then(function(e){a.tags=e}),a.filesData=[],a.totalFiles=0,a.pageCount=0,a.currentPageId=parseInt(r.getValue("filemanager.pageId",1)),a.$watch("currentPageId",function(e,t){void 0!==e&&e!=t&&a.getFilesForCurrentPage()},!0),a.$watch("currentFolderId",function(e,t){void 0!==e&&(a.generateFolderInheritance(e),a.getFilesForPageAndFolder(e,1))},!0),a.folderInheritance=[],a.generateFolderInheritance=function(e){a.folderInheritance=[],a.findFolderInheritance(e)},a.findFolderInheritance=function(e){a.foldersData&&a.foldersData.hasOwnProperty(e)&&(e=a.foldersData[e],a.folderInheritance.push(e),e&&e.parentId&&a.findFolderInheritance(e.parentId))},a.hasFolderActiveChild=function(t){var n=!1;return angular.forEach(a.folderInheritance,function(e){e.id==t&&(n=!0)}),n},a.getFilesForPageAndFolder=function(n,i){return l(function(t,e){o.get(a.createUrl(n,i,a.sortField,a.searchQuery)).then(function(e){return r.setValue("filemanager.sortField",a.sortField),r.setValue("filemanager.pageId",parseInt(i)),a.filesResponseToVars(e),t(!0)})})},a.createUrl=function(e,t,n,i){return"admin/api-admin-storage/data-files?folderId="+e+"&page="+t+"&expand=createThumbnail,createThumbnailMedium,isImage,sizeReadable&sort="+n+"&search="+i},a.filesResponseToVars=function(e){a.filesData=e.data,a.pageCount=e.headers("X-Pagination-Page-Count"),a.currentPageId=parseInt(e.headers("X-Pagination-Current-Page")),a.totalFiles=e.headers("X-Pagination-Total-Count")},a.filesMetaToPagination=function(e){a.pageCount=e.totalPages},a.getFilesForCurrentPage=function(){return a.getFilesForPageAndFolder(a.currentFolderId,a.currentPageId)},a.currentFolderId=p.folderId,a.foldersDirecotryIdReload=function(){return p.load(!0)},a.folderCountMessage=function(e){return i18nParam("js_filemanager_count_files_overlay",{count:e.filesCount})},a.errorMsg=null,a.replaceFile=function(e,t){(a.replaceFiled=e)&&(c.start(),i.upload({url:"admin/api-admin-storage/file-replace",data:{file:e,fileId:a.fileDetail.id,pageId:a.currentPageId}}).then(function(e){c.stop(),200==e.status&&(a.getFilesForCurrentPage().then(function(){u.success(i18n.js_dir_manager_file_replace_ok)}),a.openFileDetail(a.fileDetail,!0))},function(){c.stop()}))},a.$watch("uploadingfiles",function(e){if(null!=e){a.uploadResults=0,c.start(i18n.js_dir_upload_wait);for(var t=0;t<e.length;t++)a.errorMsg=null,n=e[t],a.uploadUsingUpload(n)}var n}),a.$watch("uploadResults",function(e,t){null!=a.uploadingfiles&&e==a.uploadingfiles.length&&null==a.errorMsg&&a.getFilesForCurrentPage().then(function(){u.success(i18n.js_dir_manager_upload_image_ok),c.stop()})}),a.pasteUpload=function(e){for(var t=0;t<e.originalEvent.clipboardData.items.length;t++){var n=e.originalEvent.clipboardData.items[t];"file"==n.kind&&(c.start(i18n.js_dir_upload_wait),i.upload({url:"admin/api-admin-storage/files-upload",fields:{folderId:a.currentFolderId},file:n.getAsFile()}).then(function(e){e.data.upload?m.waitFor(e.data.queueIds).then(function(e){a.getFilesForCurrentPage().then(function(){u.success(i18n.js_dir_manager_upload_image_ok),c.stop()})}):(u.error(e.data.message),c.stop())},function(e){u.error(e.data.message),c.stop()}))}},a.uploadUsingUpload=function(n){n.upload=i.upload({url:"admin/api-admin-storage/files-upload",fields:{folderId:a.currentFolderId},file:n}),n.upload.then(function(t){e(function(){m.waitFor(t.data.queueIds).then(function(e){a.uploadResults++,n.processed=!0,n.result=t.data,n.result.upload||(u.error(n.result.message),c.stop(),a.errorMsg=!0)})})},function(e){n=e.data,u.error(n.message),c.stop(),a.errorMsg=!0}),n.upload.progress(function(e){n.processed=!1,n.progress=Math.min(100,parseInt(100*e.loaded/e.total))})},a.selectedFiles=[],a.toggleSelectionAll=function(){a.filesData.forEach(function(e,t){a.toggleSelection(e)})},a.toggleSelection=function(e){var t;"true"!=a.allowSelection?-1<(t=a.selectedFiles.indexOf(e.id))?a.selectedFiles.splice(t,1):a.selectedFiles.push(e.id):a.$parent.select(e.id)},a.inSelection=function(e){return-1!=a.selectedFiles.indexOf(e.id)},a.showFolderForm=!1,a.createNewFolder=function(e){e&&o.post("admin/api-admin-storage/folder-create",{folderName:e,parentFolderId:a.currentFolderId}).then(function(e){var t=e.data;a.foldersDataReload().then(function(e){a.folderFormToggler(),a.newFolderName=null,a.changeCurrentFolderId(t)})})},a.folderFormToggler=function(){a.showFolderForm=!a.showFolderForm},a.searchQuery="",a.searchPromise=null,a.searchLoading=!1,a.runSearch=function(){0<a.searchQuery.length?(a.searchLoading=!0,n.start(),e.cancel(a.searchPromise),a.searchPromise=e(function(){a.getFilesForCurrentPage().then(function(){a.searchLoading=!1,n.complete()})},1e3)):a.getFilesForCurrentPage().then(function(){a.searchLoading=!1})},a.sortField=r.getValue("filemanager.sortField","name_original"),a.changeSortField=function(e){a.sortField=e,a.getFilesForCurrentPage()},a.changeCurrentFolderId=function(e,t){a.searchQuery="";var n=a.currentFolderId;a.currentFolderId=e,a.currentPageId=1,a.selectedFiles=[],!0!==t&&n!=e&&(p.folderId=e,o.post("admin/api-admin-common/save-filemanager-folder-state",{folderId:e},{ignoreLoadingBar:!0}))},a.toggleFolderItem=function(e){null==e.toggle_open?e.toggle_open=1:e.toggle_open=!e.toggle_open,o.post("admin/api-admin-common/filemanager-foldertree-history",{data:e},{ignoreLoadingBar:!0})},a.folderUpdateForm=!1,a.folderDeleteForm=!1,a.folderDeleteConfirmForm=!1,a.updateFolder=function(e){o.post("admin/api-admin-storage/folder-update?folderId="+e.id,{name:e.name}).then(function(e){u.success(i18n.js_dir_manager_rename_success)})},a.cancelFolderEdit=function(e,t){e.name=t},a.deleteFolder=function(n){o.post("admin/api-admin-storage/is-folder-empty?folderId="+n.id,{name:n.name}).then(function(e){var t=e.data.empty,e=e.data.count;t?o.post("admin/api-admin-storage/folder-delete?folderId="+n.id,{name:n.name}).then(function(e){a.foldersDataReload().then(function(){a.currentFolderId=0})}):u.confirm(i18nParam("layout_filemanager_remove_dir_not_empty",{folderName:n.name,count:e}),i18n.js_dir_manager_rm_folder_confirm_title,["$timeout","$toast",function(e,t){o.post("admin/api-admin-storage/folder-delete?folderId="+n.id,{name:n.name}).then(function(){a.foldersDataReload().then(function(){a.currentFolderId=0,t.close()})})}])})},a.removeFiles=function(){u.confirm(i18n.js_dir_manager_rm_file_confirm,i18n.js_dir_manager_rm_file_confirm_title,["$timeout","$toast",function(e,t){o.post("admin/api-admin-storage/filemanager-remove-files",{ids:a.selectedFiles,pageId:a.currentPageId,folderId:a.currentFolderId}).then(function(e){a.getFilesForCurrentPage().then(function(){t.close(),u.success(i18n.js_dir_manager_rm_file_ok),a.selectedFiles=[],a.closeFileDetail()})})}])},a.moveFilesTo=function(e){o.post("admin/api-admin-storage/filemanager-move-files",{fileIds:a.selectedFiles,toFolderId:e,currentPageId:a.currentPageId,currentFolderId:a.currentFolderId}).then(function(e){a.getFilesForCurrentPage().then(function(){a.selectedFiles=[],a.showFoldersToMove=!1})})},a.getFolderData=function(e){return t("filemanagerdirsfilter")(a.foldersData,e)},a.getFilesForCurrentPage(),a.fileDetail=!1,a.showFoldersToMove=!1,a.largeImagePreviewState=!0,a.fileDetailFull=!1,a.nameEditMode=!1,a.fileDetailFolder=!1,a.detailLoading=!1,a.openFileDetail=function(e,t){a.fileDetail.id==e.id&&!0!==t?a.closeFileDetail():(n.start(),a.detailLoading=!0,d.getFile(e.id,t).then(function(e){a.fileDetailFull=e,a.fileDetailFolder=a.foldersData[e.folder_id],a.detailLoading=!1,n.complete()},function(){}),a.fileDetail=e)},a.saveTagRelation=function(e,t){o.post("admin/api-admin-storage/toggle-file-tag",{tagId:e.id,fileId:t.id}).then(function(e){a.fileDetailFull.tags=e.data})},a.fileHasTag=function(t){var n=!1;return angular.forEach(a.fileDetailFull.tags,function(e){e.id==t.id&&(n=!0)}),n},a.updateFileData=function(){o.put("admin/api-admin-storage/file-update?id="+a.fileDetailFull.id+"&pageId="+a.currentPageId,a.fileDetailFull).then(function(e){t("findidfilter")(a.filesData,a.fileDetail.id,!0).name=e.data.name_original,a.nameEditMode=!1})},a.closeFileDetail=function(){a.fileDetail=!1,a.fileDetailFull=!1,a.nameEditMode=!1},a.removeFile=function(e){a.selectedFiles=[],a.toggleSelection(e),a.removeFiles()},a.isFileEditHidden=!0,a.editFile=function(e){a.isFileEditHidden=!a.isFileEditHidden},a.cropSuccess=function(){a.isFileEditHidden=!0,a.getFilesForCurrentPage().then(function(){u.success(i18n.crop_success)}),a.openFileDetail(a.fileDetail,!0)},a.storeFileCaption=function(e){o.post("admin/api-admin-storage/filemanager-update-caption",{id:e.id,captionsText:e.captionArray,pageId:a.currentPageId}).then(function(e){u.success(i18n.file_caption_success)})},a.selectedFileFromParent=null,a.init=function(){a.$parent.fileinfo&&(a.selectedFileFromParent=a.$parent.fileinfo,a.changeCurrentFolderId(a.selectedFileFromParent.folder_id,!0))},a.init()}],templateUrl:"storageFileManager"}}),zaa.directive("hasEnoughSpace",["$window","$timeout",function(a,o){return{restrict:"A",scope:{loadingCondition:"=",isFlexBox:"="},link:function(n,i,e){n.elementWidth=0;function t(){o(function(){n.elementOriginalWidth||(n.elementOriginalWidth=function(){var e=i.clone().insertAfter(i);e.css({position:"fixed",top:0,left:0,visibility:"hidden"}),"none"===e.css("display")&&e.css("display",n.isFlexBox?"flex":"block");var t=e.outerWidth();return e.remove(),t}()),i.hasClass("not-enough-space")&&(i.removeClass("not-enough-space"),i.addClass("has-enough-space")),i.parent().outerWidth()<n.elementOriginalWidth?i.removeClass("has-enough-space").addClass("not-enough-space"):i.removeClass("not-enough-space").addClass("has-enough-space")})}angular.element(a).on("resize",function(){t()}),n.$watch("loadingCondition",function(e){1==e&&t()})}}}]),zaa.directive("activeClass",function(){return{restrict:"A",scope:{activeClass:"@"},link:function(e,t){t.on("mouseenter",function(){t.addClass(e.activeClass)}),t.on("mouseleave",function(){t.removeClass(e.activeClass)}),t.on("click",function(){t.toggleClass(e.activeClass)})}}}),zaa.directive("imageEdit",function(){return{restrict:"E",scope:{fileId:"=",onSuccess:"&"},controller:["$scope","$http","$timeout",function(t,e,n){t.file,t.cropperImage,t.cropperConfig={distUrl:"",areaType:"rectangle",ratio:null,resultImageSize:"max",resultImageFormat:"image/jpeg",resultImageQuality:1,areaInitSize:200,canvasScalemode:"full-width"},t.changeQuality=function(e){t.cropperConfig.resultImageQuality=e},t.isCurrentQuality=function(e){return t.cropperConfig.resultImageQuality==e},e.get("/admin/api-admin-storage/file-info?id="+t.fileId).then(function(e){t.file=e.data,t.cropperConfig.resultImageFormat=t.file.mime_type,t.cropperImage=t.file.file.href}),t.saveAsCopy=!0,t.isCurrentRatio=function(e){return t.cropperConfig.ratio==e},t.changeRatio=function(e){t.cropperImage=!1,t.cropperConfig.ratio=e,n(function(){t.cropperImage=t.file.source})},t.save=function(){e.post("/admin/api-admin-storage/file-crop",{distImage:t.cropperConfig.distUrl,fileName:t.file.name_new_compound,extension:t.file.extension,saveAsCopy:t.saveAsCopy,fileId:t.file.id}).then(function(e){t.onSuccess()})}}],template:'\n    <div class="row">\n        <div class="col-md-8">\n            <p class="lead">'+i18n.crop_source_image+'</p>\n            <div class="bg-light rounded pt-3 pl-3 pr-3 pb-2">\n            <ui-cropper\n                ng-if="cropperImage" \n                image="cropperImage" \n                result-image="cropperConfig.distUrl"\n                result-image-format="{{cropperConfig.resultImageFormat}}"\n                result-image-quality="cropperConfig.resultImageQuality"\n                result-image-size="cropperConfig.resultImageSize"\n                area-type="{{cropperConfig.areaType}}" \n                area-init-size="cropperConfig.areaInitSize"\n                chargement="\'Loading\'"\n                canvas-scalemode="{{cropperConfig.canvasScalemode}}"\n                aspect-ratio="cropperConfig.ratio"\n            ></ui-cropper>\n            </div>\n            <ul class="list-group list-group-horizontal justify-content-center mt-3">\n                <li class="list-group-item text-center" ng-class="{\'active\':isCurrentRatio(null)}" ng-click="changeRatio(null)"><i class="material-icons">crop_free</i><br /><small>'+i18n.crop_size_free+'</small></li>\n                <li class="list-group-item text-center" ng-class="{\'active\':isCurrentRatio(\'1\')}" ng-click="changeRatio(\'1\')"><i class="material-icons">crop_square</i><br /><small>'+i18n.crop_size_1to1+'</small></li>\n                <li class="list-group-item text-center" ng-class="{\'active\':isCurrentRatio(\'1.7\')}" ng-click="changeRatio(\'1.7\')"><i class="material-icons">crop_16_9</i><br /><small>'+i18n.crop_size_desktop+'</small></li>\n                <li class="list-group-item text-center" ng-class="{\'active\':isCurrentRatio(\'0.5\')}" ng-click="changeRatio(\'0.5\')"><i class="material-icons">crop_portrait</i><br /><small>'+i18n.crop_size_mobile+'</small></li>\n            </ul>\n        </div>\n        <div class="col-md-4" ng-show="cropperImage">\n            <p class="lead">'+i18n.crop_preview+'</p>\n            <img ng-src="{{cropperConfig.distUrl}}" ng-show="cropperConfig.distUrl" class="img-fluid border" />\n\n            <ul class="list-group list-group-horizontal justify-content-center mt-3">\n                <li class="list-group-item text-center" ng-class="{\'active\':isCurrentQuality(1.0)}" ng-click="changeQuality(1.0)"><i class="material-icons">looks_one</i><br /><small>'+i18n.crop_quality_high+'</small></li>\n                <li class="list-group-item text-center" ng-class="{\'active\':isCurrentQuality(0.8)}" ng-click="changeQuality(0.8)"><i class="material-icons">looks_two</i><br /><small>'+i18n.crop_quality_medium+'</small></li>\n                <li class="list-group-item text-center" ng-class="{\'active\':isCurrentQuality(0.5)}" ng-click="changeQuality(0.5)"><i class="material-icons">looks_3</i><br /><small>'+i18n.crop_quality_low+'</small></li>\n            </ul>\n\n            <div class="form-check mt-3 rounded border p-2" ng-click="saveAsCopy=!saveAsCopy" ng-class="{\'bg-light\':saveAsCopy}">\n                <input class="form-check-input" type="checkbox" ng-model="saveAsCopy">\n                <label class="form-check-label">\n                '+i18n.crop_btn_as_copy+'\n                </label>\n                <small class="text-muted">'+i18n.crop_btn_as_copy_hint+'</small>\n            </div>\n\n            <button type="button" ng-show="saveAsCopy" class="mt-3 btn btn-lg btn-icon btn-save" ng-click="save()">'+i18n.crop_btn_save_copy+'</button>\n            <button type="button" ng-show="!saveAsCopy" class="mt-3 btn btn-lg btn-icon btn-save" ng-click="save()">'+i18n.crop_btn_save_replace+"</button>\n        </div>\n    </div>\n        "}}),zaa.directive("pagination",function(){return{restrict:"E",scope:{currentPage:"=",pageCount:"="},controller:["$scope","$timeout",function(t,e){t.pageNumberInputVal=t.currentPage,t.$watch("currentPage",function(e){t.pageNumberInputVal=e}),t.$watch("pageNumberInputVal",function(){t.inputWidth=25+10*(t.pageNumberInputVal.toString().length<=0?1:t.pageNumberInputVal.toString().length)});var n=null;t.pageNumberInputChange=function(){n&&e.cancel(n),n=e(function(){isNaN(t.pageNumberInputVal)||parseInt(t.pageNumberInputVal)>parseInt(t.pageCount)||parseInt(t.pageNumberInputVal)<=0?t.pageNumberInputVal=t.currentPage:t.currentPage=t.pageNumberInputVal},500)},t.next=function(){t.currentPage<t.pageCount&&(t.currentPage+=1)},t.prev=function(){1<t.currentPage&&--t.currentPage},t.first=function(){t.currentPage=1},t.last=function(){t.currentPage=t.pageCount}}],template:'\n            <div class="pagination" ng-show="pageCount > 1">\n                <button class="pagination-btn pagination-btn-first btn btn-icon btn-first-page" ng-click="first()" ng-disabled="currentPage == 1"></button>\n                <button class="pagination-btn pagination-btn-prev btn btn-icon btn-prev" ng-click="prev()" ng-disabled="currentPage == 1"></button>\n                <div class="pagination-page">\n                    <input ng-style="{\'max-width\': inputWidth + \'px\'}" class="form-control pagination-input" type="text" ng-model="pageNumberInputVal" ng-change="pageNumberInputChange()" />\n                    <span class="pagination-delimiter">/</span>\n                    <span class="pagination-number-of-pages">{{pageCount}}</span>\n                </div>\n                <button class="pagination-btn pagination-btn-next btn btn-icon btn-next" ng-click="next()" ng-disabled="currentPage == pageCount"></button>\n                <button class="pagination-btn pagination-btn-last btn btn-icon btn-last-page" ng-click="last()" ng-disabled="currentPage == pageCount"></button>\n            </div>\n        '}}),zaa.directive("zaaInjector",["$compile",function(n){return{restrict:"E",replace:!0,transclude:!1,scope:{dir:"=",model:"=",options:"=",label:"@label",grid:"@grid",fieldid:"@fieldid",placeholder:"@placeholder",initvalue:"@initvalue",autocomplete:"@autocomplete"},link:function(e,t){e=n(angular.element("<"+e.dir+' options="options" initvalue="{{initvalue}}" fieldid="{{fieldid}}" placeholder="{{placeholder}}" autocomplete="{{autocomplete}}" model="model" label="{{label}}" i18n="{{grid}}" />'))(e);t.replaceWith(e)}}}]),zaa.directive("zaaSortRelationArray",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},controller:["$scope","$filter",function(a,e){a.searchString,a.sourceData=[],a.dropdownOpen=!1,a.$watch(function(){return a.model},function(e,t){void 0===e&&(a.model=[])}),a.$watch(function(){return a.options},function(e,t){null!=e&&(a.sourceData=e.sourceData)}),a.getSourceOptions=function(){return a.sourceData},a.getModelItems=function(){return a.model},a.addToModel=function(n){var i=!1;angular.forEach(a.model,function(e,t){e.value===n.value&&(i=!0)}),i||a.model.push({value:n.value,label:n.label})},a.removeFromModel=function(e){a.model.splice(e,1)},a.moveUp=function(e){e=parseInt(e);var t=a.model[e];a.model[e]=a.model[e-1],a.model[e-1]=t},a.moveDown=function(e){e=parseInt(e);var t=a.model[e];a.model[e]=a.model[e+1],a.model[e+1]=t},a.elementInModel=function(n){var i=!1;return angular.forEach(a.model,function(e,t){e.value===n.value&&(i=!0)}),!i}}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><div class="list"><div class="list-item" ng-repeat="(key, item) in getModelItems() track by key"><div class="list-buttons"><i ng-show="!$first" ng-click="moveUp(key)" class="material-icons" style="transform: rotate(270deg);">play_arrow</i><i ng-show="!$last" ng-click="moveDown(key)" class="material-icons" style="transform: rotate(90deg);">play_arrow</i></div><span>{{item.label}}</span><div class="float-right"><i ng-click="removeFromModel(key)" class="material-icons">delete</i></div></div><div class="list-item" ng-show="sourceData.length != model.length"><input class="form-control" type="search" ng-model="searchString" ng-focus="dropdownOpen = true" /><ul class="list-group"><li class="list-group-item list-group-item-action" ng-repeat="option in getSourceOptions() | filter:searchString" ng-show="dropdownOpen && elementInModel(option)" ng-click="addToModel(option)"><i class="material-icons">add_circle</i><span>{{ option.label }}</span></li></ul><div class="list-chevron"><i ng-click="dropdownOpen=!dropdownOpen" class="material-icons" ng-show="dropdownOpen">arrow_drop_up</i><i ng-click="dropdownOpen=!dropdownOpen" class="material-icons" ng-show="!dropdownOpen">arrow_drop_down</i></div></div></div></div></div>'}}}),zaa.directive("zaaTagArray",function(){return{restrict:"E",scope:{model:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},controller:["$scope","$http",function(n,e){n.tags=[],e.get("admin/api-admin-common/tags").then(function(e){angular.forEach(e.data,function(e){e.id=parseInt(e.id),n.tags.push(e)})}),void 0===n.model?n.model=[]:angular.forEach(n.model,function(e,t){n.model[t]=parseInt(e)}),n.isInSelection=function(e){return e=parseInt(e),-1!==n.model.indexOf(e)},n.toggleSelection=function(e){var t=n.model.indexOf(e);-1<t?n.model.splice(t,1):n.model.push(e)}}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><span ng-click="toggleSelection(tag.id)" ng-repeat="tag in tags" ng-class="{\'badge-primary\' : isInSelection(tag.id), \'badge-secondary\' : !isInSelection(tag.id)}" class="badge badge-pill mx-1 mb-2">{{tag.name}}</span></div></div>'}}}),zaa.directive("zaaLink",["$filter",function(t){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},controller:["$scope",function(n){n.unset=function(){n.model=!1,n.data.model=null},n.data={modalState:1,model:null},n.$watch("model",function(e,t){e&&(n.data.model=e)},!0),n.$watch("data.model",function(e,t){e&&(n.model=e)},!0),n.isEmpty=function(e){return!e||t("isEmpty")(e)}}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><div ng-if="!isEmpty(data.model)"><div class="link-selector"><div class="link-selector-actions"><div class="link-selector-btn btn btn-secondary" ng-click="data.modalState=0"><i class="material-icons left">insert_link</i><span>'+i18n.js_link_change_value+'</span></div><span ng-hide="model | isEmpty" class="link-selector-reset" ng-click="unset()"><i class="material-icons">remove_circle</i></span></div><link-object-to-string class="ml-2" link="model"></link-object-to-string></div></div><div ng-if="isEmpty(data.model)"><div class="link-selector"><div class="link-selector-actions"><div class="link-selector__btn btn btn-secondary" ng-click="data.modalState=0"><i class="material-icons left">insert_link</i><span>'+i18n.js_link_set_value+'</span></div><span style="margin-left:10px;">'+i18n.js_link_not_set+'</span></div></div></div><modal is-modal-hidden="data.modalState" modal-title="{{label}}"><form ng-submit="data.modalState=1"><zaa-link-options data="data.model" uid="id" ng-if="!data.modalState"></zaa-link-options><button ng-click="data.modalState=1" class="btn btn-icon btn-save" type="submit">'+i18n.js_link_set_value+"</button></form></modal></div></div>"}}}]),zaa.directive("zaaLinkOptions",function(){return{restrict:"EA",scope:{data:"=",uid:"="},templateUrl:"linkoptions.html",controller:["$scope",function(n){n.$watch(function(){return n.data},function(e,t){angular.isArray(e)&&(n.data={})})}]}}),zaa.directive("zaaSlug",function(){return{restrict:"E",scope:{model:"=",options:"=",listener:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},controller:["$scope","$filter",function(n,i){n.$watch("listener",function(e,t){void 0!==e&&(n.model=i("slugify")(e))}),n.$watch("model",function(e,t){e!==t&&(n.model=i("slugify")(e))})}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><input id="{{id}}" insert-paste-listener ng-model="model" type="text" class="form-control" placeholder="{{placeholder}}" /></div></div>'}}}),zaa.directive("zaaColor",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},controller:["$scope",function(n){function i(){if(void 0===n.model||!n.model)return"#000";var e=n.model;return 3===(e="string"==typeof n.model?e.substr(1):e).length&&(e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,i){return t+t+n+n+i+i})),6!==e.length||128<=(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3?"#000":"#fff"}n.textColor=i(),n.$watch(function(){return n.model},function(e,t){n.textColor=i()})}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><div class="colorwheel"><div class="colorwheel-background" style="background-color: {{model}};"><input class="colorwheel-input" type="text" ng-model="model" style="color: {{textColor}}; border-color: {{textColor}};" maxlength="7" /></div><div class="colorwheel-wheel"><div ng-colorwheel="{ size: 150, segments: 120 }" ng-model="model"></div></div></div></div>'}}}),zaa.directive("zaaWysiwyg",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><ng-wig ng-disabled="false" ng-model="model" buttons="bold, italic, link, list1, list2" source-mode-allowed></ng-wig></div></div>'}}}),zaa.directive("zaaNumber",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid",placeholder:"@placeholder",initvalue:"@initvalue"},link:function(n){n.$watch(function(){return n.model},function(e,t){void 0===e&&(n.model=parseInt(n.initvalue)),angular.isNumber(n.model)?n.isValid=!0:n.isValid=!1})},template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><input id="{{id}}" ng-model="model" type="number" min="0" class="form-control" ng-class="{\'invalid\' : !isValid }" placeholder="{{placeholder}}" /></div></div>'}}}),zaa.directive("zaaDecimal",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid",placeholder:"@placeholder"},controller:["$scope",function(e){null===e.options?e.steps=.01:e.steps=e.options.steps}],link:function(n){n.$watch(function(){return n.model},function(e,t){angular.isNumber(n.model)?n.isValid=!0:n.isValid=!1})},template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><input id="{{id}}" ng-model="model" type="number" min="0" step="{{steps}}" class="form-control" ng-class="{\'invalid\' : !isValid }" placeholder="{{placeholder}}" /></div></div>'}}}),zaa.directive("zaaText",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid",placeholder:"@placeholder",autocomplete:"@autocomplete"},template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><luya-text ng-model="model" fieldid="{{id}}" autocomplete="{{autocomplete}}" placeholder="{{placeholder}}"></luya-text></div></div>'}}}),zaa.directive("luyaText",function(){return{restrict:"E",scope:{model:"=ngModel",id:"@fieldid",autocomplete:"@autocomplete",placeholder:"@placeholder"},template:function(){return'<input id="{{id}}" insert-paste-listener ng-model="model" type="text" class="form-control" autocomplete="{{autocomplete}}" placeholder="{{placeholder}}" />'}}}),zaa.directive("zaaReadonly",function(){return{restrict:"E",scope:{model:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><luya-readonly ng-model="model" fieldid="{{id}}"></luya-readonly></div></div>'}}}),zaa.directive("luyaReadonly",function(){return{restrict:"E",scope:{model:"=ngModel",id:"@fieldid"},template:function(){return'<span id="{{id}}" class="text-muted form-control-plaintext">{{model}}</span>'}}}),zaa.directive("zaaAsyncValue",function(){return{restrict:"E",scope:{model:"=",api:"@",fields:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},controller:["$scope","$timeout","$http",function(e,t,n){e.resetValue=function(){e.model=0,e.value=null}}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><luya-async-value ng-model="model" api="{{api}}" fields="fields"  ng-show="model"></luya-async-value><button type="button" class="btn btn-icon btn-cancel" ng-click="resetValue()" ng-show="model"></button></div></div>'}}}),zaa.directive("luyaAsyncValue",function(){return{restrict:"E",scope:{model:"=ngModel",api:"@",fields:"=",id:"@fieldid"},controller:["$scope","$timeout","$http",function(n,e,i){e(function(){n.$watch("model",function(e,t){e&&(n.value="",i.get(n.api+"/"+e+"?fields="+n.fields.join()).then(function(e){n.value,angular.forEach(e.data,function(e){e&&(n.value=n.value+e+" ")})}))})})}],template:function(){return'<span id="{{id}}" ng-bind="value"></span>'}}}),zaa.directive("asyncValue",function(){return{restrict:"E",scope:{model:"=",api:"@",fields:"="},controller:["$scope","$timeout","$http",function(n,e,i){e(function(){n.$watch("model",function(e,t){e&&(n.value="",i.get(n.api+"/"+e+"?fields="+n.fields.join()).then(function(e){n.value,angular.forEach(e.data,function(e){e&&(n.value=n.value+e+" ")})}))})})}],template:function(){return'<span ng-bind="value"></span>'}}}),zaa.directive("zaaTextarea",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid",placeholder:"@placeholder"},template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><luya-textarea ng-model="model" fieldid="{{id}}" placeholder="{{placeholder}}"></luya-textarea></div></div>'}}}),zaa.directive("luyaTextarea",function(){return{restrict:"E",scope:{model:"=ngModel",id:"@fieldid",placeholder:"@placeholder"},template:function(){return'<textarea id="{{id}}" insert-paste-listener ng-model="model" type="text" class="form-control" auto-grow placeholder="{{placeholder}}"></textarea>'}}}),zaa.directive("zaaPassword",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid",autocomplete:"@autocomplete",inputmode:"@inputmode"},template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><luya-password ng-model="model" fieldid="{{id}}" autocomplete="{{autocomplete}}" inputmode="{{inputmode}}"></luya-password></div></div>'}}}),zaa.directive("luyaPassword",function(){return{restrict:"E",scope:{model:"=ngModel",id:"@fieldid",autocomplete:"@autocomplete",inputmode:"@inputmode"},controller:["$scope","$timeout",function(e,t){e.init=function(){void 0!==e.autocomplete&&""!==e.autocomplete||(e.autocomplete="on"),void 0!==e.inputmode&&""!==e.inputmode||(e.inputmode="verbatim")},t(function(){e.init()})}],template:function(){return'<input id="{{id}}" ng-model="model" type="password" class="form-control" autocomplete="{{autocomplete}}" inputmode="{{inputmode}}" />'}}}),zaa.directive("zaaRadio",function(){return{restrict:"E",scope:{model:"=",options:"=",optionsvalue:"<",optionslabel:"<",label:"@",i18n:"<",id:"@fieldid",initvalue:"<",inline:"<"},controller:["$scope","$timeout",function(e,t){void 0!==e.optionsvalue&&""!==e.optionsvalue||(e.optionsvalue="value"),void 0!==e.optionslabel&&""!==e.optionslabel||(e.optionslabel="label")}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><luya-radio ng-model="model" options="options" fieldid="{{id}}" initvalue="initvalue" optionsvalue="optionsvalue" optionslabel="optionslabel" ng-attr-inline="inline"></luya-radio></div></div>'}}}),zaa.directive("luyaRadio",function(){return{restrict:"E",scope:{model:"=ngModel",options:"=",optionsvalue:"<",optionslabel:"<",id:"@fieldid",initvalue:"<",inline:"<"},controller:["$scope","$timeout",function(t,e){void 0!==t.optionsvalue&&""!==t.optionsvalue||(t.optionsvalue="value"),void 0!==t.optionslabel&&""!==t.optionslabel||(t.optionslabel="label"),t.setModelValue=function(e){t.model=e},t.init=function(){void 0!==t.model&&null!==t.model||(t.model=typeCastValue(t.initvalue)),void 0!==t.id&&null!==t.id&&""!==t.id||(t.id=Math.random().toString(36).substring(7))},e(function(){t.init()})}],template:function(){return'<div ng-repeat="(key, item) in options" class="form-check" ng-class="{\'form-check-inline\': inline}"><input value="{{item[optionsvalue]}}" type="radio" ng-click="setModelValue(item[optionsvalue])" ng-checked="item[optionsvalue] === model" name="{{id}}_{{key}}" class="form-check-input" id="{{id}}_{{key}}"><label class="form-check-label" for="{{id}}_{{key}}">{{item[optionslabel]}}</label></div>'}}}),zaa.directive("zaaSelect",function(){return{restrict:"E",scope:{model:"=",options:"=",optionsvalue:"@optionsvalue",optionslabel:"@optionslabel",label:"@label",i18n:"@i18n",id:"@fieldid",initvalue:"@initvalue",clearable:"<"},controller:["$scope","$timeout","$rootScope",function(e,t,n){void 0===e.optionsvalue&&(e.optionsvalue="value"),void 0===e.optionslabel&&(e.optionslabel="label"),void 0===e.clearable&&(e.clearable=!0)}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><luya-select ng-model="model" options="options" fieldid="{{id}}" clearable="clearable" optionsvalue="{{optionsvalue}}" optionslabel="{{optionslabel}}" initvalue="{{initvalue}}"></luya-select></div></div>'}}}),zaa.directive("luyaSelect",function(){return{restrict:"E",scope:{model:"=ngModel",options:"=",optionsvalue:"@optionsvalue",optionslabel:"@optionslabel",id:"@fieldid",initvalue:"@initvalue",clearable:"<",ngChange:"&"},controller:["$scope","$timeout","$rootScope",function(i,t,e){void(i.isOpen=0)!==i.optionsvalue&&""!==i.optionsvalue||(i.optionsvalue="value"),void 0!==i.optionslabel&&""!==i.optionslabel||(i.optionslabel="label"),angular.isNumber(i.model)&&(i.model=typeCastValue(i.model)),i.$on("closeAllSelects",function(){i.isOpen&&i.closeSelect()}),t(function(){i.$watch(function(){return i.model},function(e,t){null!=e&&""!==e||(angular.isNumber(i.initvalue)&&(i.initvalue=typeCastValue(i.initvalue)),i.valueExistsInOptions(e)||(i.model=i.initvalue))}),void 0===i.clearable&&(i.clearable=!0)}),i.valueExistsInOptions=function(t){var n=!1;return angular.forEach(i.options,function(e){t===e[i.optionsvalue]&&(n=!0)}),n},i.toggleIsOpen=function(){i.isOpen||e.$broadcast("closeAllSelects"),i.isOpen=!i.isOpen},i.closeSelect=function(){i.isOpen=0},i.setModelValue=function(e){i.model=angular.isObject(e)?e[i.optionsvalue]:e,t(i.ngChange,0),i.closeSelect()},i.getSelectedLabel=function(){var t=i18n.ngrest_select_no_selection;return angular.forEach(i.options,function(e){i.model===e[i.optionsvalue]&&(t=e[i.optionslabel])}),t},i.hasSelectedValue=function(){var e=i.model;return!(!i.valueExistsInOptions(e)||e===i.initvalue)}}],template:function(){return'<div class="zaaselect" ng-class="{\'open\':isOpen, \'selected\':hasSelectedValue()}"><select class="zaaselect-select" ng-model="model" id="{{id}}"><option ng-repeat="opt in options" ng-value="opt[optionsvalue]">{{opt[optionslabel]}}</option></select><div class="zaaselect-selected"><span class="zaaselect-selected-text" ng-click="toggleIsOpen()">{{getSelectedLabel()}}</span><i class="material-icons zaaselect-clear-icon" ng-show="clearable" ng-click="setModelValue(initvalue)">clear</i><i class="material-icons zaaselect-dropdown-icon" ng-click="toggleIsOpen()">keyboard_arrow_down</i></div><div class="zaaselect-dropdown"><div class="zaaselect-search"><input class="zaaselect-search-input" type="search" focus-me="isOpen" ng-model="searchQuery" /></div><div class="zaaselect-overflow" ng-if="isOpen"><div class="zaaselect-item" ng-repeat="opt in options | filter:searchQuery"><span class="zaaselect-label" ng-class="{\'zaaselect-label-active\': opt[optionsvalue] == model}" ng-click="opt[optionsvalue] == model ? false : setModelValue(opt)">{{opt[optionslabel]}}</span></div></div></div></div>'}}}),zaa.directive("zaaAsyncApiSelect",function(){return{restrict:"E",scope:{model:"=",api:"@api",optionsvalue:"@optionsvalue",optionslabel:"@optionslabel",label:"@label",i18n:"@i18n",id:"@fieldid",initvalue:"@initvalue"},controller:["$scope","$http","$timeout",function(n,t,e){n.options=[],void 0===n.optionsvalue&&(n.optionsvalue="id"),void 0===n.optionslabel&&(n.optionslabel="title"),n.$watch("api",function(e){t.get(e).then(function(e){var t=[];angular.forEach(e.data,function(e){t.push({label:e[n.optionslabel],value:e[n.optionsvalue]})}),n.options=t})})}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><luya-select ng-model="model" options="options" id="{{id}}" initvalue="{{initvalue}}"></luya-select></div></div>'}}}),zaa.directive("zaaSelectCrud",function(){return{restrict:"E",scope:{model:"=",options:"=",api:"@api",label:"@label",i18n:"@i18n",id:"@fieldid",initvalue:"@initvalue"},template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><async-value model="model" api="{{options.api}}" fields="options.fields"></async-value><crud-loader api="{{options.route}}" model-setter="model" model-selection="1" alias="{{label}}"></crud-loader></div></div>'}}}),zaa.directive("zaaCheckbox",function(){return{restrict:"E",scope:{model:"=",options:"=",i18n:"@i18n",id:"@fieldid",label:"@label",initvalue:"@initvalue"},controller:["$scope","$timeout",function(e,t){null===e.options||void 0===e.options?(e.valueTrue=1,e.valueFalse=0):(e.valueTrue=e.options["true-value"],e.valueFalse=e.options["false-value"]),e.init=function(){void 0!==e.model&&null!==e.model||(e.model=typeCastValue(e.initvalue))},t(function(){e.init()}),e.clicker=function(){e.model===e.valueTrue?e.model=e.valueFalse:e.model=e.valueTrue}}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><div class="form-check"><input id="{{id}}" ng-true-value="{{valueTrue}}" ng-change="change()" ng-click="clicker()" ng-false-value="{{valueFalse}}" ng-model="model" type="checkbox" class="form-check-input-standalone" ng-checked="model == valueTrue" /><label for="{{id}}"></label></div></div></div>'}}}),zaa.directive("zaaCheckboxArray",function(){return{restrict:"E",scope:{model:"=",options:"=",i18n:"@i18n",id:"@fieldid",label:"@label",preselect:"@preselect"},controller:["$scope","$filter",function(n,i){void 0===n.model&&(n.model=[]),n.preselectOptionValuesToModel=function(e){angular.forEach(e,function(e){n.model.push({value:e.value})})},n.searchString="",n.$watch("options",function(e,t){void 0!==e&&e.hasOwnProperty("items")&&(n.optionitems=i("orderBy")(e.items,"label"),n.preselect&&n.preselectOptionValuesToModel(e.items))}),n.filtering=function(){n.optionitems=i("filter")(n.options.items,n.searchString)},n.toggleSelection=function(e){for(var t in void 0===n.model&&(n.model=[]),n.model)if(n.model[t].value===e.value)return void n.model.splice(t,1);n.model.push({value:e.value})},n.isChecked=function(e){for(var t in n.model)if(n.model[t].value===e.value)return!0;return!1}}],link:function(e){e.random=Math.random().toString(36).substring(7)},template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label for="{{id}}">{{label}}</label></div><div class="form-side"><div class="position-relative mb-3"><div class="input-group"><div class="input-group-prepend"><div class="input-group-text"><i class="material-icons">search</i></div></div><input class="form-control" type="text" ng-change="filtering()" ng-model="searchString" placeholder="'+i18n.ngrest_crud_search_text+'"></div><span class="zaa-checkbox-array-counter badge badge-secondary">{{optionitems.length}} '+i18n.js_dir_till+' {{options.items.length}}</span></div><div class="form-check" ng-repeat="(k, item) in optionitems track by k"><input type="checkbox" class="form-check-input" ng-checked="isChecked(item)" id="{{random}}_{{k}}" ng-click="toggleSelection(item)" /><label for="{{random}}_{{k}}">{{item.label}}</label></div></div></div>'}}}),zaa.directive("zaaDatetime",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",id:"@fieldid",i18n:"@i18n",resetable:"@resetable"},controller:["$scope","$filter",function(n,i){n.isNumeric=function(e){return!isNaN(e)},n.$watch(function(){return n.model},function(e,t){null!=e?(e=new Date(1e3*e),n.pickerPreselect=e,n.date=i("date")(e,"dd.MM.yyyy"),n.hour=i("date")(e,"HH"),n.min=i("date")(e,"mm")):(n.date=null,n.model=null)}),n.refactor=function(e){n.isNumeric(n.hour)&&""!==n.hour||(n.hour="0"),n.isNumeric(n.min)&&""!==n.min||(n.min="0"),"Invalid Date"===e||""===e||"NaN"===e?(n.date=null,n.model=null):3===(e=e.split(".")).length&&4===e[2].length&&(23<parseInt(n.hour)&&(n.hour=23),59<parseInt(n.min)&&(n.min=59),e=e[1]+"/"+e[0]+"/"+e[2]+" "+n.hour+":"+n.min,n.model=Date.parse(e)/1e3,n.datePickerToggler=!1)},n.$watch(function(){return n.date},function(e,t){e!==t&&null!=e&&n.refactor(e)}),n.autoRefactor=function(){n.refactor(n.date)},n.datePickerToggler=!1,n.toggleDatePicker=function(){n.datePickerToggler=!n.datePickerToggler},n.openDatePicker=function(){n.datePickerToggler=!0},n.closeDatePicker=function(){n.datePickerToggler=!1},n.hour="0",n.min="0",n.reset=function(){n.model=null},n.getIsResetable=function(){return!n.resetable||parseInt(n.resetable)}}],template:function(){return'<div class="form-group form-side-by-side zaa-datetime" ng-class="{\'input--hide-label\': i18n, \'input--with-time\': model!=null && date!=null}"><div class="form-side form-side-label"><label>{{label}}</label></div><div class="form-side form-inline datepicker-wrapper"><datepicker class="input-group input-group--append-clickable" date-set="{{pickerPreselect.toString()}}" date-week-start-day="1" datepicker-toggle="false" datepicker-show="{{datePickerToggler}}" date-format="dd.MM.yyyy"><input class="form-control datepicker-date-input" ng-model="date" type="text" ng-focus="openDatePicker()" /><div class="input-group-append" ng-click="toggleDatePicker()"><div class="input-group-text"><i class="material-icons" ng-hide="datePickerToggler">date_range</i><i class="material-icons" ng-show="datePickerToggler">close</i></div></div></datepicker><div ng-show="model!=null && date!=null" class="hour-selection"><div class="input-group"><input class="form-control zaa-datetime-hour-input" type="text" ng-model="hour" ng-change="autoRefactor()" /></div><div class="input-group"><div class="input-group-prepend zaa-datetime-time-colon"><div class="input-group-text">:</div></div><input class="form-control form-control--force-border zaa-datetime-minute-input" type="text" ng-model="min" ng-change="autoRefactor()" /></div></div><div ng-show="model && getIsResetable()"><button type="button" ng-click="reset()" class="ml-2 btn btn-icon btn-cancel"></button></div></div></div>'}}}),zaa.directive("zaaDate",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",id:"@fieldid",i18n:"@i18n",resetable:"@resetable"},controller:["$scope","$filter",function(n,i){n.$watch(function(){return n.model},function(e,t){null!=e?(e=new Date(1e3*e),n.pickerPreselect=e,n.date=i("date")(e,"dd.MM.yyyy")):(n.date=null,n.model=null)}),n.refactor=function(e){"Invalid Date"===e||""===e?(n.date=null,n.model=null):3===(e=e.split(".")).length&&4===e[2].length&&(e=e[1]+"/"+e[0]+"/"+e[2],n.model=Date.parse(e)/1e3,n.datePickerToggler=!1)},n.$watch(function(){return n.date},function(e,t){e!==t&&null!=e&&n.refactor(e)}),n.autoRefactor=function(){n.refactor(n.date)},n.datePickerToggler=!1,n.toggleDatePicker=function(){n.datePickerToggler=!n.datePickerToggler},n.openDatePicker=function(){n.datePickerToggler=!0},n.closeDatePicker=function(){n.datePickerToggler=!1},n.reset=function(){n.model=null},n.getIsResetable=function(){return!n.resetable||parseInt(n.resetable)}}],template:function(){return'<div class="form-group form-side-by-side zaa-date" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label>{{label}}</label></div><div class="form-side form-inline datepicker-wrapper"><datepicker class="input-group input-group--append-clickable" date-set="{{pickerPreselect.toString()}}" date-week-start-day="1" datepicker-toggle="false" datepicker-show="{{datePickerToggler}}" date-format="dd.MM.yyyy"><input class="form-control datepicker-date-input" ng-model="date" type="text" ng-focus="openDatePicker()" /><div class="input-group-append" ng-click="toggleDatePicker()"><div class="input-group-text"><i class="material-icons" ng-hide="datePickerToggler">date_range</i><i class="material-icons" ng-show="datePickerToggler">close</i></div></div></datepicker><div ng-show="model && getIsResetable()"><button type="button" ng-click="reset()" class="ml-2 btn btn-icon btn-cancel"></button></div></div></div>'}}}),zaa.directive("zaaTable",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},controller:["$scope",function(i){void 0===i.model&&(i.model=[{0:""}]),i.addColumn=function(){var e,t,n=0;for(e in i.model[0])n++;for(t in i.model)i.model[t][n]=""},i.addRow=function(){var e,t={};for(e in i.model[0])t[e]="";i.model.push(t)},i.removeColumn=function(e){for(var t in i.model){t=i.model[t];t instanceof Array?t.splice(e,1):delete t[e]}},i.moveLeft=function(e){for(var t in e=parseInt(e),i.model){var n=i.model[t][e];i.model[t][e]=i.model[t][e-1],i.model[t][e-1]=n}},i.moveRight=function(e){for(var t in e=parseInt(e),i.model){var n=i.model[t][e];i.model[t][e]=i.model[t][e+1],i.model[t][e+1]=n}},i.moveUp=function(e){e=parseInt(e);var t=i.model[e];i.model[e]=i.model[e-1],i.model[e-1]=t},i.moveDown=function(e){e=parseInt(e);var t=i.model[e];i.model[e]=i.model[e+1],i.model[e+1]=t},i.removeRow=function(e){i.model.splice(e,1)},i.showRightButton=function(e){return parseInt(e)<Object.keys(i.model[0]).length-1},i.showDownButton=function(e){return parseInt(e)<Object.keys(i.model).length-1}}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label ng-if="label">{{label}}</label><label ng-if="!label">Table</label></div><div class="form-side"><div class="zaa-table-wrapper"><table class="zaa-table table table-bordered"><tbody><tr><th scope="col" width="35px"></th><th scope="col" data-ng-repeat="(hk, hr) in model[0] track by hk" class="zaa-table-buttons"><div class="btn-group" role="group"><button type="button" class="btn btn-sm btn-outline-info" ng-click="moveLeft(hk)" ng-if="hk > 0"><i class="material-icons">keyboard_arrow_left</i></button><button type="button" class="btn btn-sm btn-outline-info" ng-click="moveRight(hk)" ng-if="showRightButton(hk)"><i class="material-icons">keyboard_arrow_right</i></button><button type="button" class="btn btn-sm btn-outline-danger" ng-click="removeColumn(hk)"><i class="material-icons">remove</i></button></div></th></tr><tr data-ng-repeat="(key, row) in model track by key"><td width="35px" scope="row" class="zaa-table-buttons"><div class="btn-group-vertical" role="group"><button type="button" class="btn btn-sm btn-outline-info" ng-click="moveUp(key)" ng-if="key > 0"><i class="material-icons">keyboard_arrow_up</i></button><button type="button" class="btn btn-sm btn-outline-info" ng-click="moveDown(key)" ng-if="showDownButton(key)"><i class="material-icons">keyboard_arrow_down</i></button><button type="button" class="btn btn-sm btn-outline-danger" ng-click="removeRow(key)"><i class="material-icons">remove</i></button></div></td><td data-ng-repeat="(field,value) in row track by field"><textarea ng-model="model[key][field]" class="zaa-table__textarea"></textarea></td></tr></tbody></table><button ng-click="addRow()" type="button" class="zaa-table-add-row btn btn-sm btn-success"><i class="material-icons">add</i></button><button ng-click="addColumn()" type="button" class="zaa-table-add-column btn btn-sm btn-success"><i class="material-icons">add</i></button></div></div></div>'}}}),zaa.directive("zaaFileUpload",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label>{{label}}</label></div><div class="form-side"><storage-file-upload ng-model="model"></storage-file-upload></div></div>'}}}),zaa.directive("zaaImageUpload",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label>{{label}}</label></div><div class="form-side"><storage-image-upload options="options" ng-model="model"></storage-image-upload></div></div>'}}}),zaa.directive("zaaImageArrayUpload",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},link:function(e,n,t){e.$watch("model",function(e,t){1<=e.length?$(n).removeClass("is-empty").addClass("is-not-empty"):$(n).removeClass("is-not-empty").addClass("is-empty")},!0)},controller:["$scope",function(n){void 0===n.model&&(n.model=[]),n.add=function(){null!=n.model&&""!==n.model&&void 0!==n.model||(n.model=[]),n.model.push({imageId:0,caption:""})},n.remove=function(e){n.model.splice(e,1)},n.moveUp=function(e){e=parseInt(e);var t=n.model[e];n.model[e]=n.model[e-1],n.model[e-1]=t},n.moveDown=function(e){e=parseInt(e);var t=n.model[e];n.model[e]=n.model[e+1],n.model[e+1]=t},n.showDownButton=function(e){return parseInt(e)<Object.keys(n.model).length-1},n.isDescriptionEnabled=function(){return!n.options||!n.options.hasOwnProperty("description")||n.options.description},n.noFiltersOption=function(){return!(!n.options||!n.options.hasOwnProperty("filter"))&&!n.options.filter}}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label>{{label}}</label></div><div class="form-side"><div class="list zaa-file-array-upload"><p class="alert alert-info" ng-hide="model.length > 0">'+i18n.js_dir_no_selection+'</p><div ng-repeat="(key,image) in model track by key" class="list-item"><div class="list-section"><div class="list-left"><storage-image-upload ng-model="image.imageId" options="{no_filter: noFiltersOption()}"></storage-image-upload></div><div class="list-right" ng-show="isDescriptionEnabled()"><div class="form-group"><label for="{{image.id}}">'+i18n.js_dir_image_description+'</label><textarea ng-model="image.caption" id="{{image.id}}" class="zaa-file-array-upload-description form-control" auto-grow></textarea></div></div></div><div class="list-buttons"><div class="btn-group" role="group"><button type="button" class="btn btn-sm btn-outline-info" ng-click="moveUp(key)" ng-if="key > 0"><i class="material-icons">keyboard_arrow_up</i></button><button type="button" class="btn btn-sm btn-outline-info" ng-click="moveDown(key)" ng-if="showDownButton(key)"><i class="material-icons">keyboard_arrow_down</i></button><button type="button" class="btn btn-sm btn-outline-danger" ng-click="remove(key)"><i class="material-icons">remove</i></button></div></div></div><button ng-click="add()" type="button" class="btn btn-sm btn-success list-add-button"><i class="material-icons">add</i></button></div></div></div>'}}}),zaa.directive("zaaFileArrayUpload",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},controller:["$scope","$element","$timeout",function(n,e,t){void 0===n.model&&(n.model=[]),n.add=function(){null!=n.model&&""!==n.model&&void 0!==n.model||(n.model=[]),n.model.push({fileId:0,caption:""})},n.remove=function(e){n.model.splice(e,1)},n.moveUp=function(e){e=parseInt(e);var t=n.model[e];n.model[e]=n.model[e-1],n.model[e-1]=t},n.moveDown=function(e){e=parseInt(e);var t=n.model[e];n.model[e]=n.model[e+1],n.model[e+1]=t},n.showDownButton=function(e){return parseInt(e)<Object.keys(n.model).length-1}}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label>{{label}}</label></div><div class="form-side"><div class="list zaa-file-array-upload"><p class="alert alert-info" ng-hide="model.length > 0">'+i18n.js_dir_no_selection+'</p><div ng-repeat="(key,file) in model track by key" class="list-item"><div class="list-section" ng-if="file.hiddenStorageUploadSource"><a ng-href="{{file.hiddenStorageUploadSource}}" target="_blank" class="btn btn-primary">{{file.hiddenStorageUploadName}}</a></div><div class="list-section" ng-if="!file.hiddenStorageUploadSource"><div class="list-left"><storage-file-upload ng-model="file.fileId"></storage-file-upload></div><div class="list-right"><div class="form-group"><label for="{{file.id}}">'+i18n.js_dir_image_description+'</label><textarea ng-model="file.caption" id="{{file.id}}" class="zaa-file-array-upload-description form-control" auto-grow></textarea></div></div></div><div class="list-buttons"  ng-if="!file.hiddenStorageUploadSource"><div class="btn-group" role="group"><button type="button" class="btn btn-sm btn-outline-info" ng-click="moveUp(key)" ng-if="key > 0"><i class="material-icons">keyboard_arrow_up</i></button><button type="button" class="btn btn-sm btn-outline-info" ng-click="moveDown(key)" ng-if="showDownButton(key)"><i class="material-icons">keyboard_arrow_down</i></button><button type="button" class="btn btn-sm btn-outline-danger" ng-click="remove(key)"><i class="material-icons">remove</i></button></div></div></div></div><button ng-click="add()" type="button" class="btn btn-sm btn-success list-add-button"><i class="material-icons">add</i></button></div></div>'}}}),zaa.directive("zaaMultipleInputs",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},controller:["$scope","$timeout",function(n,e){n.init=function(){void 0===n.model||null===n.model?n.model=[]:angular.forEach(n.model,function(e,t){0===Object.keys(e).length&&(n.model[t]={})})},n.add=function(){null!=n.model&&""!==n.model&&void 0!==n.model||(n.model=[]),n.model.push({})},n.remove=function(e){n.model.splice(e,1)},n.moveUp=function(e){e=parseInt(e);var t=n.model[e];n.model[e]=n.model[e-1],n.model[e-1]=t},n.moveDown=function(e){e=parseInt(e);var t=n.model[e];n.model[e]=n.model[e+1],n.model[e+1]=t},n.showDownButton=function(e){return parseInt(e)<Object.keys(n.model).length-1},e(function(){n.init()})}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label>{{label}}</label></div><div class="form-side"><div class="list zaa-multiple-inputs"><p class="alert alert-info" ng-hide="model.length > 0">'+i18n.js_dir_no_selection+'</p><div ng-repeat="(msortKey,row) in model track by msortKey" class="list-item" ng-init="ensureRow(row)"><div ng-repeat="(mutliOptKey,opt) in options track by mutliOptKey"><zaa-injector dir="opt.type" options="opt.options" fieldid="id-{{msortKey}}-{{mutliOptKey}}" initvalue="{{opt.initvalue}}" label="{{opt.label}}" model="row[opt.var]"></zaa-injector></div><div class="list-buttons"><div class="btn-group" role="group"><button type="button" class="btn btn-sm btn-outline-info" ng-click="moveUp(msortKey)" ng-if="msortKey > 0"><i class="material-icons">keyboard_arrow_up</i></button><button type="button" class="btn btn-sm btn-outline-info" ng-click="moveDown(msortKey)" ng-if="showDownButton(msortKey)"><i class="material-icons">keyboard_arrow_down</i></button><button type="button" class="btn btn-sm btn-outline-danger" ng-click="remove(msortKey)"><i class="material-icons">remove</i></button></div></div></div><button ng-click="add()" type="button" class="btn btn-sm btn-success list-add-button"><i class="material-icons">add</i></button></div></div></div>'}}}),zaa.directive("zaaJsonObject",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},controller:["$scope",function(t){t.$watch("model",function(e){angular.isArray(e)&&(t.model={}),null==e&&(t.model={})}),t.add=function(e){t.model[e]=""},t.remove=function(e){delete t.model[e]}}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label>{{label}}</label></div><div class="form-side"><div class="list zaa-json-array"><div ng-repeat="(key,value) in model" class="list-item"><div class="input-group"><div class="input-group-prepend border-right"><div class="input-group-text text-muted">{{key}}</div></div><input class="form-control" type="text" ng-model="model[key]" /></div><div class="list-buttons"><div class="btn-group" role="group"><button type="button" class="btn btn-sm btn-outline-danger" ng-click="remove(key)"><i class="material-icons">remove</i></button></div></div></div><div class="input-group input-group--append-clickable"><input type="text" class="form-control" placeholder="'+i18n.js_jsonobject_newkey+'" aria-label="'+i18n.js_jsonobject_newkey+'" ng-model="newKey"><div class="input-group-append"><div class="input-group-text" ng-click="add(newKey);newKey=null;"><i class="material-icons">add</i></div></div></div></div></div></div>'}}}),zaa.directive("zaaListArray",function(){return{restrict:"E",scope:{model:"=",options:"=",label:"@label",i18n:"@i18n",id:"@fieldid"},controller:["$scope","$element","$timeout",function(n,t,e){n.init=function(){void 0!==n.model&&null!==n.model||(n.model=[])},n.add=function(){null!==n.model&&""!==n.model&&void 0!==n.model||(n.model=[]),n.model.push({value:""}),n.setFocus()},n.remove=function(e){n.model.splice(e,1)},n.refactor=function(e,t){e!==n.model.length-1&&""===t.value&&n.remove(e)},n.setFocus=function(){e(function(){var e=t.children(".list").children(".list__item:last-of-type").children(".list__left").children("input");1===e.length&&e[0].focus()},50)},n.moveUp=function(e){e=parseInt(e);var t=n.model[e];n.model[e]=n.model[e-1],n.model[e-1]=t},n.moveDown=function(e){e=parseInt(e);var t=n.model[e];n.model[e]=n.model[e+1],n.model[e+1]=t},n.showDownButton=function(e){return parseInt(e)<Object.keys(n.model).length-1},n.init()}],template:function(){return'<div class="form-group form-side-by-side" ng-class="{\'input--hide-label\': i18n}"><div class="form-side form-side-label"><label>{{label}}</label></div><div class="form-side"><div class="list zaa-file-array-upload"><p class="alert alert-info" ng-hide="model.length > 0">'+i18n.js_dir_no_selection+'</p><div ng-repeat="(key,row) in model track by key" class="list-item"><input class="form-control list-input" type="text" ng-model="row.value" /><div class="list-buttons"><div class="btn-group" role="group"><button type="button" class="btn btn-sm btn-outline-info" ng-click="moveUp(key)" ng-if="key > 0"><i class="material-icons">keyboard_arrow_up</i></button><button type="button" class="btn btn-sm btn-outline-info" ng-click="moveDown(key)" ng-if="showDownButton(key)"><i class="material-icons">keyboard_arrow_down</i></button><button type="button" class="btn btn-sm btn-outline-danger" ng-click="remove(key)"><i class="material-icons">remove</i></button></div></div></div><button ng-click="add()" type="button" class="btn btn-sm btn-success list-add-button"><i class="material-icons">add</i></button></div></div></div>'}}}),zaa.controller("DefaultDashboardObjectController",["$scope","$http","$sce",function(t,n,e){t.data,t.loadData=function(e){n.get(e).then(function(e){t.data=e.data})}}]),zaa.controller("CrudController",["cfpLoadingBar","$scope","$rootScope","$filter","$http","$sce","$state","$timeout","$injector","$q","AdminLangService","AdminToastService","CrudTabService","ServiceImagesData",function(t,l,e,n,r,i,a,o,s,d,c,u,p,f){l.toast=u,l.AdminLangService=c,l.tabService=p,l.clearData=function(){u.confirm(i18n.ngrest_delete_all_button_confirm_message,i18n.ngrest_delete_all_button_label,function(){var e=this;r.get(l.config.apiEndpoint+"/truncate").then(function(){e.close(),l.loadList()})})},l.crudSwitchType=0,l.switchToTab=function(e){angular.forEach(l.tabService.tabs,function(e){e.active=!1}),e.active=!0,l.switchTo(4)},l.addAndswitchToTab=function(e,t,n,i,a){l.tabService.addTab(e,t,n,i,a),l.switchTo(4)},l.closeTab=function(e,t){l.tabService.remove(t,l)},l.switchTo=function(e,t){l.config.relationCall?l.crudSwitchType=e:(t&&l.resetData(),0==e&&r.get(l.config.apiEndpoint+"/unlock",{ignoreLoadingBar:!0}),0!=e&&1!=e||l.config.inline||a.go("default.route"),4===(l.crudSwitchType=e)||l.config.inline||angular.forEach(l.tabService.tabs,function(e){e.active=!1}))},l.closeUpdate=function(){l.switchTo(0,!0)},l.closeCreate=function(){l.switchTo(0,!0)},l.activeWindowModal=!0,l.openActiveWindow=function(){l.activeWindowModal=!1},l.closeActiveWindow=function(){l.activeWindowModal=!0},l.changeGroupByField=function(){0==l.config.groupByField?l.config.groupBy=0:l.config.groupBy=1},l.isSettingsVisible=!1,l.toggleSettingsMenu=function(){l.isSettingsVisible=!l.isSettingsVisible},l.hiddeSettingsMenu=function(){l.isSettingsVisible=!1},l.isExportModalHidden=!0,l.exportdata={header:1,type:"xlsx"},l.toggleExportModal=function(){l.exportdata.filter=l.config.filter,l.isExportModalHidden=!l.isExportModalHidden},l.exportResponse=!1,l.generateExport=function(){r.post(l.config.apiEndpoint+"/export?"+l.config.apiExportQueryString,l.exportdata).then(function(e){l.exportResponse=e.data})},l.downloadExport=function(){var e=l.exportResponse.url;return l.exportResponse=!1,window.open(e),!1},l.applySaveCallback=function(){l.config.saveCallback&&s.invoke(l.config.saveCallback,this)},l.isOrderBy=function(e){return e==l.config.orderBy},l.changeOrder=function(e,t){l.config.orderBy=t+e,r.post("admin/api-admin-common/ngrest-order",{apiEndpoint:l.config.apiEndpoint,sort:t,field:e},{ignoreLoadingBar:!0}),l.loadList()},l.callActiveButton=function(e,t,n){var i=angular.element(n.currentTarget);i.addClass("crud-buttons-button-loading"),r.get(l.config.apiEndpoint+"/active-button?hash="+e+"&id="+t.join()).then(function(e){i.removeClass("crud-buttons-button-loading"),i.addClass("crud-buttons-button-success"),o(function(){i.removeClass("crud-buttons-button-success")},5e3),angular.forEach(e.data.events,function(e){"loadList"==e&&l.loadList()}),u.success(e.data.message)},function(e){i.removeClass("crud-buttons-button-loading"),i.addClass("crud-buttons-button-danger"),o(function(){i.removeClass("crud-buttons-button-danger")},5e3),u.error(e.data.message)})},l.reloadActiveWindow=function(){l.getActiveWindow(l.data.aw.hash,l.data.aw.itemId)},l.getActiveWindow=function(t,n,e){r.post(l.config.activeWindowRenderUrl,{itemId:n,activeWindowHash:t,ngrestConfigHash:l.config.ngrestConfigHash}).then(function(e){l.openActiveWindow(),l.data.aw.itemId=n,l.data.aw.configCallbackUrl=l.config.activeWindowCallbackUrl,l.data.aw.configHash=l.config.ngrestConfigHash,l.data.aw.hash=t,l.data.aw.content=i.trustAsHtml(e.data.content),l.data.aw.title=e.data.title,l.$broadcast("awloaded",{id:t})})},l.getActiveWindowCallbackUrl=function(e){return l.data.aw.configCallbackUrl+"?activeWindowCallback="+e+"&ngrestConfigHash="+l.data.aw.configHash+"&activeWindowHash="+l.data.aw.hash},l.sendActiveWindowCallback=function(e,t){t=t||{};return r.post(l.getActiveWindowCallbackUrl(e),$.param(t),{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},l.searchPromise=null,l.$watch("config.searchQuery",function(e,t){e!=t&&null!=e&&null!=e&&l.applySearchQuery(e)}),l.applySearchQuery=function(e){null!=e&&(o.cancel(l.searchPromise),0==e.length?l.loadList(1):(t.start(),l.searchPromise=o(function(){l.reloadCrudList(1)},700)))},l.generateSearchPromise=function(e,t){return r.post(l.generateUrlWithParams("search",t),{query:e}).then(function(e){l.parseResponseQueryToListArray(e)})},l.selectedItems=[],l.isInSelection=function(e){e=l.getRowPrimaryValue(e);return-1!=this.selectedItems.indexOf(e)},l.toggleSelection=function(e){var t=l.getRowPrimaryValue(e),e=this.selectedItems.indexOf(t);-1==e?this.selectedItems.push(t):this.selectedItems.splice(e,1)},l.sendActiveSelection=function(e){r.post(l.config.apiEndpoint+"/active-selection?index="+e,{ids:this.selectedItems}).then(function(e){angular.forEach(e.data.events,function(e){"loadList"==e&&l.loadList()}),u.success(e.data.message)},function(e){u.error(e.data.message)})},l.parentSelectInline=function(e){l.$parent.$parent.$parent.setModelValue(l.getRowPrimaryValue(e),e)},l.checkIfFieldExistsInPopulateCondition=function(e){var t=l.config.pools;if(t.hasOwnProperty(e))return t[e];if(l.config.relationCall){t=l.$parent.$parent.config.relations[parseInt(l.config.relationCall.arrayIndex)].relationLink;if(null!==t&&t.hasOwnProperty(e))return parseInt(l.config.relationCall.id)}return!1},l.relationItems=[],l.deleteItem=function(e,t){u.confirm(i18n.js_ngrest_rm_page,i18n.ngrest_button_delete,["$toast",function(t){r.delete(l.config.apiEndpoint+"/"+e).then(function(e){l.loadList(),t.close(),u.success(i18n.js_ngrest_rm_confirm)},function(e){l.printErrors(e)})}])},l.toggleUpdate=function(t){l.resetData(),r.get(l.config.apiEndpoint+"/"+t+"?"+l.config.apiUpdateQueryString).then(function(e){e=e.data;l.data.update=e,l.config.relationCall?l.crudSwitchType=2:l.switchTo(2),l.config.inline||a.go("default.route.detail",{id:t}),l.data.updateId=t},function(e){u.error(i18n.js_ngrest_error)})},l.highlightPkValue=null,l.highlightTimeout=5e3,l.isRowHighlighted=function(e){return l.getRowPrimaryValue(e)==l.highlightPkValue},l.submitUpdate=function(t){r.put(l.config.apiEndpoint+"/"+l.data.updateId,angular.toJson(l.data.update,!0)).then(function(e){u.success(i18n.js_ngrest_rm_update),l.loadList(l.pager.currentPage).then(function(){l.applySaveCallback(),t&&l.switchTo(0,!0),l.highlightPkValue=l.getRowPrimaryValue(e.data),o(function(){l.highlightPkValue=null},l.highlightTimeout)})},function(e){l.printErrors(e.data)})},l.submitCreate=function(t,n){r.post(l.config.apiEndpoint,angular.toJson(l.data.create,!0)).then(function(e){u.success(i18n.js_ngrest_rm_success),l.loadList().then(function(){l.applySaveCallback(),t&&l.switchTo(0,!0),l.resetData(),l.highlightPkValue=l.getRowPrimaryValue(e.data),o(function(){l.highlightPkValue=null},l.highlightTimeout),n&&l.toggleUpdate(e.data.id)})},function(e){l.printErrors(e.data)})},l.printErrors=function(e){angular.forEach(e,function(e,t){u.error(e.message)})},l.resetData=function(){l.data.create=angular.copy({}),l.data.update=angular.copy({})},l.changeNgRestFilter=function(){r.post("admin/api-admin-common/ngrest-filter",{apiEndpoint:l.config.apiEndpoint,filterName:l.config.filter},{ignoreLoadingBar:!0}),l.loadList(1)},l.pager={currentPage:1,pageCount:1,perPage:0,totalItems:0},l.$watch("pager.currentPage",function(e,t){e===t||null==e||null==e||l.loadList(e)},!0),l.setPagination=function(e,t,n,i){l.totalRows=i,l.pager={currentPage:parseInt(e),pageCount:t,perPage:n,totalItems:i}},l.toggleStatus=function(t,n,i,e){var a=!e?1:0,o=t[l.config.pk],e={};e[n]=a,r.put(l.config.apiEndpoint+"/"+o+"?ngrestCallType=update&fields="+n,angular.toJson(e,!0)).then(function(e){t[n]=a,u.success(i18nParam("js_ngrest_toggler_success",{field:i}))},function(e){l.printErrors(e)})},l.sortableUp=function(e,t,n){var i=l.data.listArray[e-1];l.data.listArray[e-1]=t,l.data.listArray[e]=i,l.updateSortableIndexPositions(n)},l.sortableDown=function(e,t,n){var i=l.data.listArray[e+1];l.data.listArray[e+1]=t,l.data.listArray[e]=i,l.updateSortableIndexPositions(n)},l.updateSortableIndexPositions=function(i){angular.forEach(l.data.listArray,function(e,t){var n={};n[i]=t;e=l.getRowPrimaryValue(e);r.put(l.config.apiEndpoint+"/"+e+"?ngrestCallType=update&fields="+i,angular.toJson(n,!0),{ignoreLoadingBar:!0})})},l.loadService=function(){l.initServiceAndConfig()},l.evalSettings=function(e){e.hasOwnProperty("order")&&(l.config.orderBy=e.order),e.hasOwnProperty("filterName")&&(l.config.filter=e.filterName)},l.getRowPrimaryValue=function(t){var e=l.config.pk;if(angular.isArray(e)){var n=[];return angular.forEach(e,function(e){n.push(t[e])}),n.join()}return t[l.config.pk]},l.tagsFilterIds=[],l.isTagFilterActive=function(e){return-1!=l.tagsFilterIds.indexOf(e)},l.toggleTagFilter=function(e){var t=l.tagsFilterIds.indexOf(e);-1==t?l.tagsFilterIds.push(e):l.tagsFilterIds.splice(t,1),l.loadList()},l.initServiceAndConfig=function(){var t=d.defer();return r.get(l.config.apiEndpoint+"/services?"+l.config.apiServicesQueryString).then(function(e){l.service=e.data.service,l.serviceResponse=e.data,l.evalSettings(e.data._settings),l.$parent.notifications&&l.$parent.notifications.hasOwnProperty(l.serviceResponse._authId)&&delete l.$parent.notifications[l.serviceResponse._authId],t.resolve()}),t.promise},l.toggleNotificationMute=function(){r.post(l.config.apiEndpoint+"/toggle-notification",{mute:!l.serviceResponse._notifcation_mute_state}).then(function(e){l.initServiceAndConfig()})},l.getFieldHelp=function(e){return!!(l.serviceResponse&&l.serviceResponse._hints&&l.serviceResponse._hints.hasOwnProperty(e))&&l.serviceResponse._hints[e]},l.loadList=function(e){return null==e&&l.pager?l.reloadCrudList(l.pager.currentPage):l.reloadCrudList(e)},l.totalRows=0,l.requestedImages=[],l.parseResponseQueryToListArray=function(n){l.setPagination(n.headers("X-Pagination-Current-Page"),n.headers("X-Pagination-Page-Count"),n.headers("X-Pagination-Per-Page"),n.headers("X-Pagination-Total-Count")),l.data.listArray=n.data,l.requestedImages=[],angular.forEach(l.service,function(e,t){e.hasOwnProperty("lazyload_images")&&angular.forEach(n.data,function(e){l.requestedImages.push(e[t])})}),o(function(){f.loadImages(l.requestedImages).then(function(){l.$broadcast("requestImageSourceReady"),l.requestedImages=[]})})},l.generateUrlWithParams=function(e,t){e=l.config.apiEndpoint+"/"+e+"?"+l.config.apiListQueryString;l.config.orderBy&&(e=e+"&sort="+l.config.orderBy.replace("+","")),void 0!==t&&(e=e+"&page="+t);t=l.config.searchQuery;t&&(e=e+"&query="+t);t=l.tagsFilterIds.join(",");return e=t?e+"&tags="+t:e},l.reloadCrudList=function(e){var t=d.defer();if(0==parseInt(l.config.filter)||null===l.config.filter){if(l.config.relationCall)n=(n=l.generateUrlWithParams("relation-call",e))+"&arrayIndex="+l.config.relationCall.arrayIndex+"&id="+l.config.relationCall.id+"&modelClass="+l.config.relationCall.modelClass;else{if(l.config.searchQuery)return l.generateSearchPromise(l.config.searchQuery,e);var n=l.generateUrlWithParams("list",e)}r.get(n).then(function(e){t.resolve(e),l.parseResponseQueryToListArray(e)})}else n=(n=l.generateUrlWithParams("filter",e))+"&filterName="+l.config.filter,r.get(n).then(function(e){l.parseResponseQueryToListArray(e),t.resolve(e)});return t.promise},l.service=!1,l.$on("secondMenuClick",function(){l.isInitalized&&(l.loadList(),l.switchTo(0,!0))}),l.data={create:{},update:{},aw:{},list:{},updateId:0},l.isInitalized=!1,l.$watch("config",function(e,t){o(function(){l.initServiceAndConfig().then(function(){l.isInitalized=!0,l.loadList()})})})}]),zaa.controller("ActiveWindowTagController",["$scope","$http","AdminToastService",function(n,e,i){n.crud=n.$parent,n.tags=[],n.relation={},n.newTagName=null,n.loadTags=function(){e.get(n.crud.getActiveWindowCallbackUrl("LoadTags")).then(function(e){n.tags=e.data})},n.loadRelations=function(){e.get(n.crud.getActiveWindowCallbackUrl("LoadRelations")).then(function(e){n.relation={},e.data.forEach(function(e,t){n.relation[e.tag_id]=1})})},n.saveTag=function(){var t=n.newTagName;""!==t&&n.crud.sendActiveWindowCallback("SaveTag",{tagName:t}).then(function(e){e.data?(n.tags.push({id:e.data,name:t}),i.success(t+" wurde gespeichert.")):i.error(t+" "+i18n.js_tag_exists),n.newTagName=null})},n.saveRelation=function(t,e){n.crud.sendActiveWindowCallback("SaveRelation",{tagId:t.id,value:e}).then(function(e){n.relation[t.id]=e.data,i.success(i18n.js_tag_success)})},n.$watch(function(){return n.data.aw.itemId},function(e,t){n.loadRelations()}),n.loadTags()}]),zaa.controller("ActiveWindowGalleryController",["$scope","$http","$filter",function(a,e,t){a.crud=a.$parent,a.files=[],a.select=function(e){0==t("filter")(a.files,{fileId:e},!0).length&&a.crud.sendActiveWindowCallback("AddImageToIndex",{fileId:e}).then(function(e){e=e.data;a.files.push(e)})},a.loadImages=function(){e.get(a.crud.getActiveWindowCallbackUrl("loadAllImages")).then(function(e){a.files=e.data})},a.changePosition=function(e,t,n){var t=parseInt(t),i=a.files[t];"up"==n?(a.files[t]=a.files[t-1],a.files[t-1]=i):"down"==n&&(a.files[t]=a.files[t+1],a.files[t+1]=i);t=a.files[t];a.crud.sendActiveWindowCallback("ChangeSortIndex",{new:t,old:i})},a.moveUp=function(e,t){a.changePosition(e,t,"up")},a.moveDown=function(e,t){a.changePosition(e,t,"down")},a.remove=function(e,t){a.crud.sendActiveWindowCallback("RemoveFromIndex",{imageId:e.originalImageId}).then(function(e){a.files.splice(t,1)})},a.$watch(function(){return a.data.aw.itemId},function(e,t){a.loadImages()})}]),zaa.controller("ActiveWindowGroupAuth",["$scope","$http","CacheReloadService",function(n,e,t){n.crud=n.$parent,n.reload=function(){t.reload()},n.rights=[],n.auths=[],n.save=function(e){n.crud.sendActiveWindowCallback("saveRights",{data:e}).then(function(e){n.getRights(),n.reload()})},n.clearModule=function(e){angular.forEach(e,function(e){n.rights[e.id]={base:0,create:0,update:0,delete:0}})},n.toggleModule=function(e){angular.forEach(e,function(e){n.rights[e.id]={base:1,create:1,update:1,delete:1}})},n.toggleGroup=function(e){objectGroup=n.rights[e],1==objectGroup.base?(objectGroup.create=1,objectGroup.update=1,objectGroup.delete=1):0==objectGroup.base&&(objectGroup.create=0,objectGroup.update=0,objectGroup.delete=0)},n.toggleAll=function(){angular.forEach(n.auths,function(e){angular.forEach(e,function(e){n.rights[e.id]={base:1,create:1,update:1,delete:1}})})},n.untoggleAll=function(){angular.forEach(n.auths,function(e){angular.forEach(e,function(e){n.rights[e.id]={base:0,create:0,update:0,delete:0}})})},n.getRights=function(){e.get(n.crud.getActiveWindowCallbackUrl("getRights")).then(function(e){n.rights=e.data.rights,n.auths=e.data.auths})},n.$on("awloaded",function(e,t){n.getRights()}),n.$watch(function(){return n.data.aw.itemId},function(e,t){n.getRights()})}]),zaa.controller("DefaultController",["$scope","$http","$state","$stateParams","CrudTabService",function(a,t,n,i,o){a.moduleId=n.params.moduleId,a.loadDashboard=function(){return a.currentItem=null,a.getDashboard(a.moduleId),n.go("default",{moduleId:a.moduleId})},a.isOpenModulenav=!1,a.items=[],a.itemRoutes=[],a.currentItem=null,a.dashboard=[],a.itemAdd=function(e,t){for(var n in a.items.push({name:e,items:t}),t){n=t[n];a.itemRoutes[n.route]={alias:n.alias,icon:n.icon}}},a.getDashboard=function(e){t.get("admin/api-admin-menu/dashboard",{params:{nodeId:e}}).then(function(e){a.dashboard=e.data})},a.init=function(){a.get(),a.getDashboard(a.moduleId)},a.resolveCurrentItem=function(){var e;a.currentItem||"default.route"!=n.current.name&&"default.route.detail"!=n.current.name||(e=[i.moduleRouteId,i.controllerId,i.actionId].join("/"),a.itemRoutes.indexOf(e)&&(a.currentItem=a.itemRoutes[e],a.currentItem.route=e))},a.click=function(e){a.isOpenModulenav=!1;var t=(a.currentItem=e).route.split("/");o.clear(),a.$broadcast("secondMenuClick",{item:e}),n.go("default.route",{moduleRouteId:t[0],controllerId:t[1],actionId:t[2]})},a.get=function(){t.get("admin/api-admin-menu/items",{params:{nodeId:a.moduleId}}).then(function(e){var t,n=e.data;for(t in n.groups){var i=n.groups[t];a.itemAdd(i.name,i.items)}a.resolveCurrentItem()})},a.hasSubUnreadNotificaton=function(e){return a.$parent.notifications&&a.$parent.notifications.hasOwnProperty(e.authId)?a.$parent.notifications[e.authId]:0},a.$on("topMenuClick",function(e){a.currentItem=null}),a.init()}]),zaa.controller("DashboardController",["$scope",function(e){e.logItemOpen=!1}]),zaa.filter("lockFilter",function(){return function(e,t,n){var i=!1;return angular.forEach(e,function(e){e.lock_table==t&&e.lock_pk==n&&(i=e)}),i}}),zaa.controller("LayoutMenuController",["$scope","$document","$http","$state","$timeout","$window","$filter","HtmlStorage","CacheReloadService","AdminDebugBar","LuyaLoading","AdminToastService","AdminClassService",function(a,e,n,o,i,t,l,r,s,d,c,u,p){a.AdminClassService=p,a.AdminDebugBar=d,a.LuyaLoading=c,a.toastQueue=u.queue,a.reload=function(){s.reload()},a.reload=function(e){(0==e?t.location:s).reload()},a.reloadButtonCall=function(e){n.get("admin/api-admin-common/reload-button-call?key="+e).then(function(e){u.success(e.data.message)})},a.isHover=r.getValue("sidebarToggleState",!1),a.toggleMainNavSize=function(){a.isHover=!a.isHover,r.setValue("sidebarToggleState",a.isHover)},a.profile={},a.settings={},a.packages=[],a.getProfileAndSettings=function(){n.get("admin/api-admin-user/session").then(function(e){a.profile=e.data.user,a.settings=e.data.settings,a.packages=e.data.packages})},a.browser=null,a.detectBrowser=function(){a.browser=[bowser.name.replace(" ","-").toLowerCase()+"-"+bowser.version,bowser.mac?"mac-os-"+(bowser.osversion||""):"windows-"+(bowser.osversion||"")].join(" ")},a.detectBrowser(),a.getProfileAndSettings(),a.debugDetail=null,a.debugDetailKey=null,a.loadDebugDetail=function(e,t){a.debugDetail=e,a.debugDetailKey=t},a.closeDebugDetail=function(){a.debugDetail=null,a.debugDetailKey=null},a.notify=null,a.forceReload=0,a.showOnlineContainer=!1,a.searchDetailClick=function(t,i){"custom"==t.type?a.click(t.menuItem).then(function(){var n;t.stateProvider?(n={},angular.forEach(t.stateProvider.params,function(e,t){n[t]=i[e]}),o.go(t.stateProvider.state,n).then(function(){a.closeSearchInput()})):a.closeSearchInput()}):a.click(t.menuItem.module).then(function(){var e=t.menuItem.route.split("/");o.go("default.route",{moduleRouteId:e[0],controllerId:e[1],actionId:e[2]}).then(function(){var n;t.stateProvider?(n={},angular.forEach(t.stateProvider.params,function(e,t){n[t]=i[e]}),o.go(t.stateProvider.state,n).then(function(){a.closeSearchInput()})):a.closeSearchInput()})})},a.visibleAdminReloadDialog=!1,a.lastKeyStroke=Date.now(),e.bind("keyup",function(e){a.lastKeyStroke=Date.now()}),a.notifications=[],function t(){n.post("admin/api-admin-timestamp",{lastKeyStroke:a.lastKeyStroke},{ignoreLoadingBar:!0}).then(function(e){a.forceReload=e.data.forceReload,a.notifications=e.data.notifications,a.forceReload&&!a.visibleAdminReloadDialog&&(a.visibleAdminReloadDialog=!0,u.confirm(i18n.js_admin_reload,i18n.layout_btn_reload,function(){a.reload(),a.visibleAdminReloadDialog=!1})),a.locked=e.data.locked,a.notify=e.data.useronline,a.idleStrokeDashoffset=e.data.idleStrokeDashoffset,a.idleTimeRelative=e.data.idleTimeRelative,i(t,2e4)})}(),a.isLocked=function(e,t){return l("lockFilter")(a.locked,e,t)},a.getLockedName=function(e,t){t=a.isLocked(e,t);return t.firstname+" "+t.lastname},a.searchQuery=null,a.searchInputOpen=!1,a.escapeSearchInput=function(){a.searchInputOpen&&a.closeSearchInput()},a.toggleSearchInput=function(){a.searchInputOpen=!a.searchInputOpen},a.openSearchInput=function(){a.searchInputOpen=!0},a.closeSearchInput=function(){a.searchInputOpen=!1},a.searchResponse=null,a.hasUnreadNotificaton=function(e){var e=e.authIds,t=0;return angular.forEach(e,function(e){e&&a.notifications.hasOwnProperty(e)&&(t+=parseInt(a.notifications[e]))}),t},a.$watch(function(){return a.searchQuery},function(e,t){e!==t&&(2<e.length?n.get("admin/api-admin-search",{params:{query:e}}).then(function(e){a.searchResponse=e.data}):a.searchResponse=null)}),a.items=[],a.currentItem={},a.isOpen=!1,a.click=function(e){return a.isOpen=!1,a.$broadcast("topMenuClick",{menuItem:e}),e.template?o.go("custom",{templateId:e.template}):o.go("default",{moduleId:e.id})},a.isActive=function(e){if(e.template){if(o.params.templateId==e.template)return a.currentItem=e,!0}else if(o.params.moduleId==e.id)return a.currentItem=e,!0},a.get=function(){n.get("admin/api-admin-menu").then(function(e){a.items=e.data})},a.get()}]),zaa.controller("AccountController",["$scope","$http","$window","AdminToastService",function(t,n,i,a){t.pass={},t.changePassword=function(){n.post("admin/api-admin-user/change-password",t.pass).then(function(e){a.success(i18n.aws_changepassword_succes),t.pass={}},function(e){a.errorArray(e.data),t.pass={}})},t.changeSettings=function(e){n.post("admin/api-admin-user/change-settings",e).then(function(e){i.location.reload()})},t.removeDevice=function(e){n.post("admin/api-admin-user/remove-device",{deviceId:e.id}).then(function(){a.success(i18n.js_account_update_profile_success),t.getProfile()})},t.profile={},t.settings={},t.activities={},t.email={},t.devices=[],t.twoFa={},t.twoFaBackupCode=!1,t.getProfile=function(){n.get("admin/api-admin-user/session").then(function(e){t.profile=e.data.user,t.settings=e.data.settings,t.activities=e.data.activities,t.devices=e.data.devices,t.twoFa=e.data.twoFa})},t.changePersonData=function(e){n.put("admin/api-admin-user/session-update",e).then(function(e){a.success(i18n.js_account_update_profile_success),t.getProfile()},function(e){a.errorArray(e.data)})},t.changeEmail=function(){n.put("admin/api-admin-user/change-email",{token:t.email.token}).then(function(e){a.success(i18n.js_account_update_profile_success),t.getProfile()},function(e){a.errorArray(e.data)})},t.registerTwoFa=function(){n.post("admin/api-admin-user/register-twofa",{secret:t.twoFa.secret,verification:t.twoFa.verification}).then(function(e){t.twoFaBackupCode=e.data.backupCode,a.success(i18n.js_account_update_profile_success),t.getProfile()},function(e){a.errorArray(e.data)})},t.disableTwoFa=function(){n.post("admin/api-admin-user/disable-twofa").then(function(){a.success(i18n.js_account_update_profile_success),t.getProfile()})},t.getProfile()}]),zaa.directive("luyaSchedule",function(){return{restrict:"E",relace:!0,scope:{value:"=",attributeValues:"=",primaryKeyValue:"=",modelClass:"@",attributeName:"@",onlyIcon:"@",title:"@"},controller:["$scope","$http","$timeout","AdminToastService",function(i,t,n,a){i.getFirstAttributeKeyAsDefaultValue=function(){return i.attributeValues[0].value},i.newvalue=i.getFirstAttributeKeyAsDefaultValue(),i.isVisible=!1,i.upcomingAccordionOpen=!0,i.archiveAccordionOpen=!1,i.showDatepicker=!1,i.modalPositionClass="",i.$watch("showDatepicker",function(e){0===e&&(e=new Date,i.timestamp=e.getTime()/1e3)}),i.toggleWindow=function(){i.isVisible=!i.isVisible,i.isVisible?i.getLogTable():i.hideInlineModal()},i.escModal=function(){i.isVisible&&(i.isVisible=!1,i.hideInlineModal())},i.getUniqueFormId=function(e){return e+i.primaryKeyValue+"_"+i.attributeName},i.logs={upcoming:[],archived:[]},i.getLogTable=function(e){t.get("admin/api-admin-common/scheduler-log?model="+i.modelClass+"&pk="+i.primaryKeyValue+"&target="+i.attributeName).then(function(e){i.logs.archived=[],i.logs.upcoming=[],e.data.forEach(function(e){(e.is_done?i.logs.archived:i.logs.upcoming).push(e)}),angular.forEach(i.logs.archived,function(e,t){e.id==i.latestId&&(i.value=e.new_attribute_value)}),n(function(){i.showInlineModal()})})},i.valueToLabel=function(t){var n;return angular.forEach(i.attributeValues,function(e){e.value==t&&(n=e.label)}),n};var e=(new Date).getTime()/1e3;i.latestId,i.timestamp=parseInt(e),i.saveNewJob=function(){t.post("admin/api-admin-common/scheduler-add",{model_class:i.modelClass,primary_key:i.primaryKeyValue,target_attribute_name:i.attributeName,new_attribute_value:i.newvalue,schedule_timestamp:i.timestamp}).then(function(e){i.latestId=e.data.id,i.getLogTable()},function(e){a.errorArray(e.data)})},i.deleteJob=function(e){t.delete("admin/api-admin-common/scheduler-delete?id="+e.id).then(function(e){i.getLogTable()})}}],link:function(o,l,e){var r=l.find(".inlinemodal"),i=l.find(".inlinemodal-arrow"),s=l.find(".scheduler-btn");o.alignModal=function(){var e=$(document).width(),t=(l.parents(".luya-content")[0].scrollHeight||$(document).height(),s[0].getBoundingClientRect()),n=e-(t.left+t.width+30),i=t.left-30,a=500<=n||i<=n,n=i<300&&n<300;r.removeClass("inlinemodal--left inlinemodal--right inlinemodal--full"),n?(r.addClass("inlinemodal--full"),r.css({display:"block",left:15,right:15,top:15,bottom:15})):a?(r.addClass("inlinemodal--right"),r.css({display:"block",left:t.left+t.width+15,right:15,width:"auto"})):(r.addClass("inlinemodal--left"),r.css({display:"block",left:1e3<t.left?"auto":15,right:e+15-t.left,width:1e3<t.left?"100%":"auto"})),o.alignModalArrow()},o.alignModalArrow=function(){var e=r[0].getBoundingClientRect(),t=s[0].getBoundingClientRect(),n=i.outerHeight(),t=t.top-15-n/2,n=e.height-15-n/2-10;t<=10?t=10:(0<n?n:5e3)<=t&&(t=n),i.css({top:t})},o.showInlineModal=function(){o.alignModal()},o.hideInlineModal=function(){r.css({display:"none"})},angular.element(window).bind("resize",function(){o.isVisible&&o.alignModal()}),$(window).on("scroll",function(){o.isVisible&&o.alignModalArrow()}),l.parents().on("scroll",function(){o.isVisible&&o.alignModalArrow()})},template:function(){return'<div class="scheduler" ng-class="{\'inlinemodal--open\' : isVisible}"><button ng-click="toggleWindow()" type="button" class="scheduler-btn btn btn-link"><i class="material-icons">schedule</i><span ng-hide="onlyIcon">{{valueToLabel(value)}}</span></button><div class="inlinemodal" style="display: none;" ng-class="modalPositionClass" zaa-esc="escModal()"><div class="inlinemodal-inner"><div class="inlinemodal-head clearfix"><div class="modal-header"><h5 class="modal-title">{{title}}</h5><div class="modal-close"><button type="button" class="close" aria-label="Close" ng-click="toggleWindow()"><span aria-hidden="true"><span class="modal-esc">ESC</span> &times;</span></button></div></div></div><div class="inlinemodal-content"><div class="clearfix"><zaa-select model="newvalue" options="attributeValues" label="'+i18n.js_scheduler_new_value+'"></zaa-select><zaa-checkbox model="showDatepicker" fieldid="{{getUniqueFormId(\'datepicker\')}}" label="'+i18n.js_scheduler_show_datepicker+'"></zaa-checkbox><zaa-datetime ng-show="showDatepicker" model="timestamp" label="'+i18n.js_scheduler_time+'"></zaa-datetime><button type="button" class="btn btn-save btn-icon float-right" ng-click="saveNewJob()">'+i18n.js_scheduler_save+'</button></div><div class="card mt-4" ng-class="{\'card-closed\': !upcomingAccordionOpen}" ng-hide="logs.upcoming.length <= 0"><div class="card-header" ng-click="upcomingAccordionOpen=!upcomingAccordionOpen"><span class="material-icons card-toggle-indicator">keyboard_arrow_down</span><i class="material-icons">alarm</i>&nbsp;<span> '+i18n.js_scheduler_title_upcoming+'</span><span class="badge badge-secondary float-right">{{logs.upcoming.length}}</span></div><div class="card-body p-2"><div class="table-responsive"><table class="table table-hover table-align-middle"><thead><tr><th>'+i18n.js_scheduler_table_newvalue+"</th><th>"+i18n.js_scheduler_table_timestamp+'</th><th></th></tr></thead><tbody><tr ng-repeat="log in logs.upcoming"><td>{{valueToLabel(log.new_attribute_value)}}</td><td>{{log.schedule_timestamp*1000 | date:\'short\'}}</td><td style="width: 60px;"><button type="button" class="btn btn-delete btn-icon" ng-click="deleteJob(log)"></button></td></tr></tbody></table></div></div></div><div class="card mt-3" ng-class="{\'card-closed\': !archiveAccordionOpen}" ng-hide="logs.archived.length <= 0"><div class="card-header" ng-click="archiveAccordionOpen=!archiveAccordionOpen"><span class="material-icons card-toggle-indicator">keyboard_arrow_down</span><i class="material-icons">alarm_on</i>&nbsp;<span> '+i18n.js_scheduler_title_completed+'</span><span class="badge badge-secondary float-right">{{logs.archived.length}}</span></div><div class="card-body p-2"><div class="table-responsive"><table class="table table-hover table-align-middle"><thead><tr><th>'+i18n.js_scheduler_table_newvalue+"</th><th>"+i18n.js_scheduler_table_timestamp+'</th></tr></thead><tbody><tr ng-repeat="log in logs.archived"><td>{{valueToLabel(log.new_attribute_value)}}</td><td>{{log.schedule_timestamp*1000 | date:\'short\'}}</td></tr></tbody></table></div></div></div></div></div><div class="inlinemodal-arrow"></div></div></div>'}}});